<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" initial-scale="1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">

    <link rel="apple-touch-icon" sizes="180x180" href="/flex_docs/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/flex_docs/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/flex_docs/images/favicons/favicon-16x16.png">
    <link rel="mask-icon" href="/flex_docs/images/favicons/safari-pinned-tab.svg" color="#5bbad5">

    <title>flextool</title>
    <meta name="description" content="flextool is a transpiler that extends C++ for new introspection, reflection and compile-time execution..">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="canonical" href="/search/">
    <link rel="manifest" href="/flex_docs/manifest.json">
    <meta name="theme-color" content="#424242">
    <script src="https://unpkg.com/lunr@0.7.1/lunr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunr-languages@1.0.0/lunr.stemmer.support.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunr-languages@1.0.0/lunr.multi.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunr-languages@1.0.0/lunr.ru.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <style>.form-wrapper input[type=text]{width:130px;transition:width .4s ease-in-out}.form-wrapper input[type=text]:focus{width:100%}.form-wrapper{background-color:#f6f6f6;background-image:linear-gradient(top,#f6f6f6,#eae8e8);border-color:#dedede #bababa #aaa;border-style:solid;border-width:1px;border-radius:10px;box-shadow:0 3px 3px hsla(0,0%,100%,.1),0 3px 0 #bbb,0 4px 0 #aaa,0 5px 5px #444;margin:100px auto;overflow:hidden;padding:8px;width:450px}.form-wrapper #search-box{border:1px solid #ccc;box-shadow:inset 0 1px 1px #ddd,0 1px 0 #fff;border-radius:3px;color:#2e2e2e;float:left;font:16px Lucida Sans,Trebuchet MS,Tahoma,sans-serif;height:42px;padding:10px;width:320px}.form-wrapper #search-box:focus{border-color:#aaa;box-shadow:inset 0 1px 1px #bbb;outline:0}.form-wrapper #search-box:-moz-placeholder,.form-wrapper #search-box:-ms-input-placeholder,.form-wrapper #search-box::-webkit-input-placeholder{color:#999;font-weight:400}.form-wrapper #submit{background-color:#0483a0;background-image:linear-gradient(top,#31b2c3,#0483a0);border:1px solid #00748f;border-radius:3px;box-shadow:inset 0 1px 0 hsla(0,0%,100%,.3),0 1px 0 #fff;color:#fafafa;cursor:pointer;height:42px;float:right;font:15px Arial,Helvetica;padding:0;text-transform:uppercase;text-shadow:0 1px 0 rgba(0,0,0,.3);width:100px}.form-wrapper #submit:focus,.form-wrapper #submit:hover{background-color:#31b2c3;background-image:linear-gradient(top,#0483a0,#31b2c3)}.form-wrapper #submit:active{box-shadow:inset 0 1px 4px rgba(0,0,0,.5);outline:0}.form-wrapper #submit::-moz-focus-inner{border:0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,ul{margin:0;padding:0}blockquote,dl,figure,h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-bottom:15px}img{max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:17.5px}ol,ul{margin-left:30px}li>ol,li>ul{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:300}a{color:#0366d6;text-decoration:none}a:visited{color:#1756a9}a:hover{color:#157fef;text-decoration:none}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code,pre{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:1540px;margin-right:auto;margin-left:auto;padding-right:30px;padding-left:30px}@media screen and (max-width:800px){.wrapper{max-width:1170px;padding-right:15px;padding-left:15px}}.footer-col-wrapper:after,.wrapper:after{content:"";display:table;clear:both}.icon>svg{display:inline-block;width:16px;height:16px;vertical-align:middle}.icon>svg path{fill:#828282}b,strong{font-weight:700}*{box-sizing:border-box}.border{border:1px solid #e8e8e8}.jumbotron{background:url(/images/services-codelines.svg),#fafbfc;background-position:center 10%;background-size:cover;padding:10px;color:#648cdb;font-weight:700;font-size:22px;margin:10px;text-align:center;vertical-align:middle}.py-3{padding-top:3px!important;padding-bottom:3px!important}.site-header{border-top:1px solid #e8e8e8;background-color:hsla(0,0%,100%,.9);border-bottom:1px solid #e8e8e8;height:80px;position:relative;width:100%}.mx-auto{margin-right:auto!important;margin-left:auto!important}.flex-items-center{-ms-flex-align:center!important;align-items:center!important}.flex-justify-between{-ms-flex-pack:justify!important;justify-content:space-between!important}.site-nav-container{display:-ms-flexbox;display:flex;width:auto;max-width:1012px}.width-full{width:100%!important}.site-header{z-index:1;font-size:16px;background-clip:padding-box;position:fixed;top:0;left:0}.clearfix:after,.clearfix:before{display:table;content:""}.clearfix:after{clear:both}.site-title{font-size:20px;line-height:60px;letter-spacing:-1px;margin-bottom:0;float:left}.site-title,.site-title:visited{margin:5px;margin-left:10px}.site-nav{float:left;line-height:60px}.site-nav .menu-icon{display:none}.site-nav .page-link{color:#111;line-height:1.5}.site-nav .page-link:not(:first-child){margin-left:20px}@media screen and (max-width:600px){.site-nav{position:absolute;top:9px;right:30px;background-color:#fdfdfd;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .menu-icon{display:block;float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg{width:18px;height:15px}.site-nav .menu-icon>svg path{fill:#424242}.site-nav .trigger{clear:both;display:none}.site-nav:hover .trigger{display:block;padding-bottom:5px}.site-nav .page-link{display:block;padding:5px 10px}}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{float:left;margin-bottom:15px;padding-left:15px}.footer-col-1{width:calc(35% - 15px)}.footer-col-2{width:calc(20% - 15px)}.footer-col-3{width:calc(45% - 15px)}@media screen and (max-width:800px){.footer-col-1,.footer-col-2{width:calc(50% - 15px)}.footer-col-3{width:calc(100% - 15px)}}@media screen and (max-width:600px){.footer-col{float:none;width:calc(100% - 15px)}}.page-content{padding:30px 0;margin-top:60px}.page-heading{font-size:20px}.post-list{margin-left:0;list-style:none}.post-list>li{margin-bottom:30px}.post-meta{font-size:17.5px;color:#828282}.post-link{display:block;font-size:24px}.post-header{margin-bottom:30px}.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (max-width:800px){.post-title{font-size:36px}}.post-content{margin-bottom:30px}.post-content h2{font-size:32px}@media screen and (max-width:800px){.post-content h2{font-size:28px}}.post-content h3{font-size:26px}@media screen and (max-width:800px){.post-content h3{font-size:22px}}.post-content h4{font-size:20px}@media screen and (max-width:800px){.post-content h4{font-size:18px}}.header-link{color:#d2d2d2;font-size:18px;margin-left:5px;position:relative;opacity:.01;\-webkit-transition:opacity .2s ease-in-out .1s;\-moz-transition:opacity .2s ease-in-out .1s;\-ms-transition:opacity .2s ease-in-out .1s}h1:hover .header-link,h2:hover .header-link,h3:hover .header-link,h4:hover .header-link,h5:hover .header-link,h6:hover .header-link{opacity:1}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}header h2{margin:25px 10px;font-size:28px;text-align:center;color:#fff8dc}.container{margin:0 auto;display:table;max-width:1540px;width:100%}.container:after,.container:before{content:"";clear:both}nav.menu{background:#3678bd;position:relative;min-height:45px;height:100%;width:100%}.menu>ul>li{list-style:none;display:inline-block;color:#fff;line-height:45px}.menu>ul li a,.xs-menu li a{text-decoration:none;color:#fff;display:block;padding:0 24px}.menu>ul li a:hover{background:#444;color:#fff;transition-duration:.3s;-moz-transition-duration:.3s;-webkit-transition-duration:.3s}.displaynone,.xs-menu-cont{display:none}.xs-menu-cont>a{background:none repeat scroll 0 0 coral;border-radius:3px;padding:3px 6px;display:block;border-bottom:1px solid #e67248;box-shadow:0 1px 2px #e67248;-webkit-box-shadow:0 1px 2px #e67248;-moz-box-shadow:0 1px 2px #e67248}.xs-menu-cont>a:hover{cursor:pointer}.xs-menu li{color:#fff;padding:14px 30px;border-bottom:1px solid #ccc;background:coral}.xs-menu a{text-decoration:none}.mega-menu{background:none repeat scroll 0 0 #68778a;left:0;margin-top:-3px;position:absolute;width:100%;padding:15px;display:none;transition-duration:.9s}#menutoggle i{color:#fff;font-size:33px;margin:0;padding:0}.mm-3column:after,.mm-3column:before,.mm-6column:after,.mm-6column:before{content:"";display:table;clear:both}.mm-3column,.mm-6column{float:left;position:relative}.mm-6column{width:50%}.mm-3column{width:25%}.responsive-img{display:block;max-width:100%}.left-images{margin-right:25px}.left-categories-list,.left-images{float:left}.categories-list li{display:block;line-height:normal;margin:0;padding:5px 0}.categories-list li :hover{background:inherit!important}.left-images>p{background:none repeat scroll 0 0 coral;display:block;font-size:18px;line-height:normal;margin:0;padding:5px 14px}.categories-list span{font-size:18px;padding-bottom:5px;text-transform:uppercase}.mm-view-more{background:none repeat scroll 0 0 coral;color:#1756a9;display:inline!important;line-height:normal;padding:5px 8px!important;margin-top:10px}.display-on{display:block;transition-duration:.9s}.drop-down>a:after{content:"\f103";color:#fff;font-family:FontAwesome;font-style:normal;margin-left:5px}@media (max-width:600px){.menu{display:none}.xs-menu li a{padding:0}.xs-menu-cont{display:block}}.animated{animation-duration:1s;animation-fill-mode:both}@keyframes a{0%{opacity:0}to{opacity:1}}.fadeIn{animation-name:a}body{font-family:Helvetica,Arial,sans-serif;font-size:20px;line-height:1.5;font-weight:300;color:#111;background-color:#fdfdfd;-webkit-text-size-adjust:100%}</style>

    <noscript>
          <link rel="stylesheet" href="/flex_docs/css/main.min.css">
    </noscript>

</head>

<script>

// define a d3 diagonal projection for use by the node paths later on.
var diagonal = d3.svg.diagonal()
.projection(function(d) {
    return [d.y, d.x];
});

var activeTooltip = null;

//This maps the siblings together mapping uses the ID using the blue line
var siblings = [{
    type: "straight",
    source: {
        id: "a39bfa12-6617-5e8e-9470-d26b68787e52",
        name: "Janie Norton"
    },
    target: {
        id: "522266d2-f01a-5ec0-9977-622e4cb054c0",
        name: "Helen Alvarado"
    }
},
{
    type: "straight",
    source: {
        id: "dea01728f-e542-53a6-acd0-6f43805c31a3",
        name: "Chadrlotte Martin"
    },
    target: {
        id: "4f910dbe4-b827-50be-b783-6baa3249f6ebc",
        name: "Do12anald Cox"
    }
},
{
    type: "curve",
    source: {
        id: "d384197e-2e1e-5fb2-987b-d90a5cdc3c15",
        name: "Mina Freeman"
    },
    target: {
        id: "dea01728f-e542-53a6-acd0-6f43805c31a3",
        name: "Chadrlotte Martin"
    }
},
{
    type: "curve",
    source: {
        id: "d384197e-2e1e-5fb2-987b-d90a5cdc3c15",
        name: "Mina Freeman"
    },
    target: {
        id: "4f910dbe4-b827-50be-b783-6baa3249f6ebc",
        name: "Do12anald Cox"
    }
},
{
    type: "straight",
    source: {
        id: "16c2b0cb-cd31-53be-81bd-9b088af96904",
        name: "G Morton"
    },
    target: {
        id: "06c7b0cb-cd21-53be-81bd-9b088af96904",
        name: "Nell Morton"
    }
},
{
    type: "curve",
    source: {
        id: "522266d2-f01a-5ec0-9977-622e4cb054c0"
    },
    target: {
        id: "efbd2396d-s478ad5cbc-b168-52e028452f3b"
    }
},
{
    type: "curve",
    source: {
        id: "qew Gonzales"
    },
    target: {
        id: "Helen Alvarado"
    }
}];

var data;
var svg;
var g;
var gElem;
var nodes, links;
var tree = d3.layout.tree();
var zoom;
var rootNode;

var boxWidth = 410,
    boxHeight = 100;

var containerWidth = 500;
var containerHeight = 500;

var maxScale = 100, minScale = 0.1;

var svgSize = {
  x: 500,
  y: 500
}

var startPos = {
  x: 0, 
  y: 0
};

function buildNodeHtml(d, i, classData) {
  console.log(d.font_size)
  var font_size = d.font_size ? d.font_size : "40px";
  return '<div style="width:'+(boxWidth)+'px;height:'+(boxHeight)+'px">\
        <div class="nodeObjectContent-outer ' + classData["nodeObjectContentOuterClasses"] + '" style="float:left;margin-left:0px"><div id="nodeObjectContent_' + d.id + '" class="nodeObjectContent ' + classData["nodeObjectContentClasses"] + '">\
          <div style="float:right; width:295px;"> \
            <div style="margin-right:5px;"> \
              <div style="line-height:83px;float:right; width:390px;height:100px;border-radius:5px;margin-top:5px;text-align:center;vertical-align:middele;font-size:'+font_size+';" class="treeNodeTitle"> \
                ' + d.name + ' \
              </div> \
            </div> \
          </div> \
        </div></div> \
      </div>';
}

function buildCustomHtml(d, i, classData) {
    console.log(d.font_size)
    var font_size = d.font_size ? d.font_size : "40px";
     console.log(font_size)
  return d.customHtml;
}

var nodePresets = {
  "researching": function (d, i) {
      return buildNodeHtml(d, i, {
        "nodeObjectContentOuterClasses": "bubbleOuter",
        "nodeObjectContentClasses": "bubbleNodeObject"
      });
  }, 
  "researched": function (d, i) {
      return buildNodeHtml(d, i, {
        "nodeObjectContentOuterClasses": "",
        "nodeObjectContentClasses": "goldenNodeObject"
      });
  }, 
  "available": function (d, i) {
      return buildNodeHtml(d, i, {
        "nodeObjectContentOuterClasses": "greenOuter",
        "nodeObjectContentClasses": "greenNodeObject"
      });
  }, 
  "unavailable": function (d, i) {
      return buildNodeHtml(d, i, {
        "nodeObjectContentOuterClasses": "darkOuter",
        "nodeObjectContentClasses": "darkNodeObject"
      });
  }, 
  "customHtml": function (d, i) {
      return buildCustomHtml(d, i, {});
  }
};

function zoomToBoundingBox(d) {

 // getBBox() is a native SVG element method
 //console.log(d3.select(".techtree g").node().getBBox())


        var bbox = d3.select("#treeLayers").node().getBBox();
        //console.log(tree)


       svg.transition().duration(0).attr('transform',function(d) {

   // var nodes = tree;

   // var d = $.grep(nodes, function(e){ return e.id == 'treeLayers'; })[0];


           // var proportions = Math.max(bbox.width+1000,bbox.height+1000)
            //var widthScale = containerWidth/proportions
           //var heightScale = containerHeight/proportions 
            //var scale = 0.26143790849673204;//Math.max(widthScale,heightScale);

            var scale = Math.min( containerWidth/bbox.width, containerHeight/bbox.height);
            //console.log(containerWidth, bbox.width, containerWidth/bbox.width)
            //console.log(containerHeight, bbox.height, containerHeight/bbox.height)
            var svgScale = getScale(svg);


            var currentx = d3.transform(d3.select('#treeLayers').attr("transform")).translate;
           // console.log(currentx)


           // console.log(d3.select('#treeLayers')[0].attr("width"))

            var elemWidth = bbox.width;//parseInt(d3.select('#treeLayers').attr("width"))/2;
            var elemHeight = bbox.height;//parseInt(d3.select('#treeLayers').attr("height"))/2;
            var elemX =  bbox.x;//parseInt(d3.select('#treeLayers').attr("x"),10)
            var elemY =  bbox.y;//parseInt(d3.select('#treeLayers').attr("y"),10)
            var transX = -(elemX +  elemWidth/2)*scale  + containerWidth/2;
            var transY = -(elemY +  elemHeight/2)*scale + containerHeight/2 ;
            console.log(elemX,elemY )
            zoom.scale( scale*svgScale[1] ).translate( [transX, transY] );

           return 'translate(' + transX+ ','+ transY+ ')scale('+scale*svgScale[0]+', '+scale*svgScale[1]+')' ;
        })

      // centerNode(d3.select('#treeLayers'));

       // centerNode(d3.select("#treeLayers").node());

       /* var
            centroid = [bbox.x + bbox.width/2, bbox.y + bbox.height/2],
            zoomScaleFactor = containerWidth / bbox.width,
            zoomX = -centroid[0],
            zoomY = -centroid[1];*/

        // set a transform on the parent group element
       /* d3.select('#techtree')
            .attr("transform", "scale(" + zoomScaleFactor + ")" +
                "translate(" + zoomX + "," + zoomY + ")");*/


    //var foHeight = div[0][0].getBoundingClientRect().height;
   /* var bounds = getBboxXY(d);
    console.log(bounds)
    var dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / containerWidth, dy / containerHeight))),
      translate = [containerWidth / 2 - scale * x, containerHeight / 2 - scale * y];*/

  /*var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / containerWidth, dy / containerHeight))),
      translate = [containerWidth / 2 - scale * x, containerHeight / 2 - scale * y];*/

 /* svg.transition()
      .duration(750)
       .call(zoom.translate(translate).scale(scale).event); // not in d3 v4*/
      //.call( zoom.transform, d3.zoomIdentity.translate(translate[0],translate[1]).scale(scale) ); // updated for d3 v4
}

/**
This defines teh line between siblings.
**/
function sblingLine(d, i) {
    var start = nodes.filter(function (v) {

        if (d.source.id == v.id) {
            return true;
        } else {
            return false;
        }
    });
    var end = nodes.filter(function (v) {
    if(d.target.collapsed || d.source.collapsed){
      return false;
    }

        if (d.target.id == v.id) {
            return true;
        } else {
            return false;
        }
    });
    if (typeof start[0] == "undefined" || typeof end[0] == "undefined") {
      return "";
    }



    var linedata = [{
        x: start[0].x,
        y: start[0].y
    }, {
        x: end[0].x,
        y: end[0].y
    }];
    //console.log(linedata )
    /*var fun = d3.svg.line().x(function (d) {
        return d.x;
    }).y(function (d) {
        return d.y;
    }).interpolate("linear");
    return fun(linedata);*/

  var sourceX = start[0].x,
      sourceY = start[0].y + (boxWidth / 2),
      targetX = end[0].x,
      targetY = end[0].y - (boxWidth / 2);

if (d.type==="curve") {
  return diagonal({
                        source: linedata[0],
                        target: linedata[1]
                    });
}

      
 return "M" + sourceY + "," + sourceX
    + "H" + (sourceY + (targetY-sourceY)/2)
    + "V" + targetX 
    + "H" + targetY;

}

var calcLeft = function(d){
  var height = containerHeight;
  var l = d.y;
  console.log(d.y)
  if(!d.isRight){
    l = height - d.y;
  }
  return {x : d.x, y : l};
};

function getBboxXY(elem) {
  var bbox = elem.getBBox();
  var x = bbox.x-((bbox.width));
  var y = bbox.y-((bbox.height));

  return {
    x: x, 
    y: y
  };
}

function getScale(elem) {
  var scale = d3.transform(elem.attr("transform")).scale;
  return typeof scale == undefined ? [1,1] : scale;
}

// https://www.visualcinnamon.com/2016/05/animate-gradient-imitate-flow-d3.html
function createLinearGradient(elem, id, colours, animateSpeed) {
    var gradient = elem.append('linearGradient')
      .attr('id', id)
      .attr("spreadMethod", "reflect")
      .attr("gradientUnits", "userSpaceOnUse")
      .attr("x1","0%")
      .attr("y1","0%")
      .attr("x2","100%")
      .attr("y2","0%");
  gradient.selectAll(".stop")
  .data(colours)
  .enter().append("stop")
  .attr("offset", function(d,i) { return i/(colours.length-1); })   
  .attr("stop-color", function(d) { return d; });

  if (animateSpeed) {
    gradient.append("animate")
      .attr("attributeName","x1")
      .attr("values","0%;100%")
      .attr("dur", animateSpeed + "s")
      .attr("repeatCount","indefinite");

    gradient.append("animate")
      .attr("attributeName","x2")
      .attr("values","100%;200%")
      .attr("dur", animateSpeed + "s")
      .attr("repeatCount","indefinite");
  }
}

function centerNode(source, scale, width, height, duration) {
    if (!source) return;
    scale = typeof scale === "undefined" ? getScale(svg) : scale;
    width = typeof width === "undefined" ? parseInt(svg.attr("width"),10) : containerWidth;
    height = typeof height === "undefined" ? parseInt(svg.attr("height"),10) : containerHeight;
    duration = typeof duration === "undefined" ? 1000 : duration;

    x = -source.y * scale[1] + width/2;
    y = -source.x * scale[1] + height/2;

    svg.transition()
        .duration(duration)
        .attr("transform", "translate(" + x + "," + y + ") scale(" + scale[0] + "," + scale[1] + ")");
    zoom.scale( scale[1] ).translate( [x, y] );
}

function createTechTree(width, height, dataFile) {
    containerWidth = width;
    containerHeight = height;
    //console.log($("#techTreeContainer").data("something"))
    var bWidth = typeof $("#techTreeContainer").data("boxwidth") === 'undefined' ? boxWidth : parseInt($("#techTreeContainer").data("boxwidth"), 10);
    var bHeight = typeof $("#techTreeContainer").data("boxheight") === 'undefined' ? boxHeight : parseInt($("#techTreeContainer").data("boxheight"), 10);
    boxWidth = bWidth;
    boxHeight = bHeight;

  // Setup zoom and pan
  zoom = d3.behavior.zoom()
  .scaleExtent([minScale, maxScale])
  .on('zoom', function(){
    var wcanvas = $(".techtree").width();
    var hcanvas = $(".techtree").height();
    var h = d3.select(".techtree g").node().getBBox().height*d3.event.scale;
    var w = d3.select(".techtree g").node().getBBox().width*d3.event.scale;
    var padding = 0;
    var translation = d3.event.translate;
    var tbound = -(h-hcanvas)-padding;
    var bbound = padding;
    var lbound = -(w-wcanvas)-padding;
    var rbound = padding;
    var space = 100;

    // limit pan area
    var tx = Math.min(100000, Math.max(d3.event.translate[0], -100000)),
        ty = Math.min(100000, Math.max(d3.event.translate[1], -100000));

    svg.attr("transform", "translate(" + tx + "," + ty + ") scale(" + d3.event.scale + ")");
    zoom.translate([tx, ty]);
    console.log(d3.event.scale)
    zoom.scale(d3.event.scale);

    var bbox = gElem.getBBox();

      var x = bbox.x-((bbox.width));
      var y = bbox.y-((bbox.height));
  })
  // Offset so that first pan and zoom does not jump back to the origin
  .translate([startPos.x, startPos.y])
  ;

svgSize.x = containerWidth;
svgSize.y = containerHeight;

var div = d3.select("#techTreeContainer").append("div");
div.html('<div style="position:absolute;z-index:9999;width:'+svgSize.x+'px;height:'+svgSize.y+'px;" class="techTreeContainerIcons"> \
  <div class="iconsRight"> \
    <button class="techTreeContainerIcon button_basic-small _pin-bottom" id="zoomPlus"> + </button> \
    <button class="techTreeContainerIcon button_basic-small _pin-bottom" id="zoomMinus"> - </button> \
  </div> \
  </div>');

d3.select("#techTreeContainer").on('mouseover', function() {
  $('.techTreeContainerIcons').show();
}).on('mouseout', function() {
  $('.techTreeContainerIcons').hide();
});

function zoomDelta(delta, time) {
  var svgScale = zoom.scale() + delta;
  time = typeof time === 'undefined' ? 0 : time;
  if (svgScale < minScale || svgScale > maxScale) {
    return;
  }
  var currentTranslate = d3.transform(svg.attr("transform")).translate;

  zoom.scale( parseFloat(svgScale) ).translate(currentTranslate);;
  svg.transition()
      .duration(time)
      .attr("transform", "translate(" + currentTranslate[0] + "," + currentTranslate[1] + ") scale(" + svgScale + "," + svgScale + ")");
}

d3.selectAll('#zoomPlus').on('click', function() {
  zoomDelta(0.03);
}); 

d3.selectAll('#zoomMinus').on('click', function() {
  zoomDelta(-0.03);
}); 

svg = d3.select("#techTreeContainer").append("svg")
  .attr('class', 'techtree')
  .attr('id', 'techtree')
  .attr('overflow', 'scroll')
  .call(zoom)
  .attr('width', svgSize.x)
  .attr('height', svgSize.y)
  .append('g')
  .attr('width', svgSize.x)
  .attr('height', svgSize.y)
  
  // Left padding of tree so that the whole root node is on the screen.
  // TODO: find a better way
  .attr("transform", "translate("+startPos.x+","+startPos.y+") scale(" + 1 + ")")
  .attr('overflow', 'scroll')
;

g = svg.select("g");
gElem = svg.selectAll("g")[0].parentNode;
  
  // Using nodeSize we are able to control
  // the separation between nodes. If we used
  // the size parameter instead then d3 would
  // calculate the separation dynamically to fill
  // the available space.
  tree.nodeSize([boxHeight* 3.5, boxWidth  * 2.5])
  
  // By default, cousins are drawn further apart than siblings.
  // By returning the same value in all cases, we draw cousins
  // the same distance apart as siblings.
  .separation(function(){
    return 0.5;
  })
  
  // Tell d3 what the child nodes are. Remember, we're drawing
  // a tree so the ancestors are child nodes.
  .children(function(treeNode){
    
    // If the treeNode is collapsed then tell d3
    // that they don't have any ancestors.
    if(treeNode.collapsed){
      return;
    } else {
      return treeNode._parents;
    }
  });

  if (typeof dataFile !== "undefined") {
    d3.json(dataFile, function(error, json){
    
      if(error) {
        return console.error(error);
      }
      
      data = json;


      nodes = tree.nodes(data);
      links = tree.links(nodes);
      startFocusNode = $.grep(nodes, function(e){ return e.start_focus; })[0];
      
      drawTechtree();

      //centerNode(startFocusNode);
      zoomToBoundingBox(startFocusNode);
        
    });
  } else {
    
    data = treeDataJson;


    nodes = tree.nodes(data);
    links = tree.links(nodes);
    startFocusNode = $.grep(nodes, function(e){ return e.start_focus; })[0];
    
    drawTechtree();

    //centerNode(startFocusNode);
    zoomToBoundingBox(startFocusNode);
  }

}

function drawTechtree(){
d3.select("#treeLayers").remove();

  nodes = tree.nodes(data);
  links = tree.links(nodes);

    links = links.filter(function (d) {
        
        if (d.target.deleted || d.source.deleted) {
            console.log(d)
        } else {
            return d;
        };
    });


    nodes = nodes.filter(function (d) {
        
        if (d.deleted) {
            console.log(d)
        } else {
            return d;
        };
    });


  var layers = svg.append('g')
    .attr("id", "treeLayers")
    .attr("class", "treeLayers");

  var layer1 = layers.append('g');
  var layer2 = layers.append('g');
  var layer3 = layers.append('g');

  // Update nodes    
  var node = layer2.selectAll("g.treeNode")
      
      // The function we are passing provides d3 with an id
      // so that it can track when data is being added and removed.
      // This is not necessary if the tree will only be drawn once
      // as in the basic example.
      .data(nodes, function(treeNode){ return treeNode.id; });
      
  // Add any new nodes
  var nodeEnter = node.enter().append("g")
      .attr("class", "treeNode")
      ;

  // Update the position of both old and new nodes
  node.attr("transform", function(d) { 
    if (d.fixed_x && d.fixed_y) {
      d.x = d.fixed_x;
      d.y = d.fixed_y;
      return "translate(" + d.y + "," + d.x + ")"; 
    }
    return "translate(" + d.y + "," + d.x + ")"; 
  });

  var svgDefs = nodeEnter.append('defs');

  var markerTypes = [
    { id: 0, name: 'circle', path: 'M 0, 0  m -5, 0  a 5,5 0 1,0 10,0  a 5,5 0 1,0 -10,0', viewbox: '-6 -6 12 12', class:"arrowHeadGold" }
  , { id: 1, name: 'square', path: 'M 0,0 m -5,-5 L 5,-5 L 5,5 L -5,5 Z', viewbox: '-5 -5 10 10', class:"arrowHeadGold" }
  , { id: 2, name: 'arrow', path: 'M 0,0 m -5,-5 L 5,0 L -5,5 Z', viewbox: '-5 -5 10 10', class:"arrowHeadGold" }
  , { id: 2, name: 'stub', path: 'M 0,0 m -1,-5 L 1,-5 L 1,5 L -1,5 Z', viewbox: '-1 -5 2 10', class:"arrowHeadGold" }
  ]


    svgDefs.selectAll("marker").data(markerTypes).enter().append('svg:marker')
            .attr({
                "id": function(d){ return 'marker_' + d.name},
                'markerUnits': 'strokeWidth',
                'viewBox': function(d){ return d.viewbox },
                "refX":0,
                "refY":0,
                "markerWidth":5,
                "markerHeight":5,
                'xoverflow':'visible',
                "orient":"auto"
            })
            .append("path")
                .attr('d', function(d){ return d.path })
                .attr("class", function(d){ return d.class });

    /*svgDefs.append("marker")
            .attr({
                "id":"arrow-start",
                "viewBox":"0 -5 10 10",
                "refX":5,
                "refY":0,
                "markerWidth":4,
                "markerHeight":4,
                "orient":"auto"
            })
            .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("class","arrowHead");*/

  createLinearGradient(svgDefs, 'goldGradient', ["#ebd197", "#b48811", "#ebd197"], 0);
  createLinearGradient(svgDefs, 'goldGradientAnim', ["#ebd197", "#b48811", "#ebd197"], 1);
  createLinearGradient(svgDefs, 'bubbleGradient', ["#46b5f4", "#2da5e5", "#46b5f4"], 0);
  createLinearGradient(svgDefs, 'bubbleGradientAnim', ["#46b5f4", "#2da5e5", "#46b5f4"], 1);
  createLinearGradient(svgDefs, 'iconGradient', ["#FFF", "#CCC"], false);

nodeEnter.append("foreignObject")
  //  .style("border", "1px solid #444")
  .attr({
    x: -(boxWidth/2),
    y: -(boxHeight/2),
    width: boxWidth,
    height: boxHeight
  })
  .attr("display", function (d) {
    if (d.hiddenObject) {
        return "none"
    } else {
        return ""
    };
  })
  .attr("class", function(d, i) { return "nodeObject " + (d.url ? " cpointer" : ""); })// "nodeObject cpointer")
  .attr("id", function(d, i) { return "nodeObject_" + d.id; })
  .append("xhtml:body")
  .style("font", "14px 'Helvetica Neue'")
  .html(function(d, i) { 
      var preset = d.preset ? d.preset : "researched";
      return nodePresets[preset](d,i); 
  });


    


  d3.selectAll('.nodeObject').on('click', function() {
    var id = this.id.replace('nodeObject_','');
    var nodes = tree.nodes(data);
    var d = $.grep(nodes, function(e){ return e.id == id; })[0];
    if (!d.url) {
        return;
    }
    window.location.href = d.url;
  }); 

  d3.selectAll('.nodeObject').on('mousemove', function() {

    if (activeTooltip==null) {
        return;
    }
   /*activeTooltip = {
        'mouseoverTime':Date.now(),
        'elem': d
    };*/
    var elapsedTime = Date.now() - activeTooltip.mouseoverTime;
    var delaySecs = 1;
    if (elapsedTime/1000.0 < delaySecs) {
        return;
    }

    var id = this.id.replace('nodeObject_','');
    var nodes = tree.nodes(data);
    var d = $.grep(nodes, function(e){ return e.id == id; })[0];

    var x = d.fixed_x ? d.fixed_x : d.x;
    var y = d.fixed_y ? d.fixed_y : d.y;

    layer3.selectAll('.svg-tooltip').remove();
    layer3.selectAll('polygon').remove();

    var scale = getScale(svg);
    var foWidth = 300;

    var leftPixelSpace = d3.event.x;
    var rightPixelSpace = containerWidth - leftPixelSpace; 
    var topPixelSpace = d3.event.y;
    var bottomPixelSpace = containerHeight - topPixelSpace;

    if (!d.tooltip) {
        return;
    }

    var t = 50, k = 15;
    var tip = {'w': (3/4 * t) , 'h': k };

    var tooltopOffset = {
      x: boxWidth/32,
      y: boxHeight/2
    }

    var offset = {
      x:0,
      y:0
    };

    /*if (leftPixelSpace > rightPixelSpace) {
      offset.y = foWidth;
    } else {
      offset.y = 0;
    }*/

    var mouseToTooltipPos = {
      x: x - boxHeight/2 + (d3.mouse(this)[1]) ,
      y: y - boxWidth/2 + (d3.mouse(this)[0]) 
    };

    var anchor = {'w': mouseToTooltipPos.y, 'h': mouseToTooltipPos.x };

    var fo = layer3.append('foreignObject')
        .attr({
            'width': foWidth,
            'class': 'svg-tooltip',
            'transform': 'translate(' +( mouseToTooltipPos.y - offset.y )+ ',' +( mouseToTooltipPos.x - offset.x) + ') scale(' + 1/scale[0] + ',' +  1/scale[0] + ')'
        });
    var div = fo.append('xhtml:div')
        .append('div')
        .attr({
            'class': 'tooltip'
        });
    div.html('<div style="background: linear-gradient(to bottom right, #ebd197, #b48811);">' + d.tooltip + '.</div>');

    var foHeight = div[0][0].getBoundingClientRect().height;
    /*var foHeight = div[0][0].getBoundingClientRect().height / scale[0];
    if (topPixelSpace > bottomPixelSpace) {
      offset.x = foHeight;
    } else {
      offset.x = 0;
    }*/

    /*fo.attr({
      'x': mouseToTooltipPos.y - offset.y,
      'y': mouseToTooltipPos.x - offset.x,
    });

    fo.attr({
        'height': foHeight
    });*/
    
    layer3.insert('polygon', '.svg-tooltip')
    .attr({
         'points': "0,0 0," + foHeight + " " + foWidth + "," + foHeight + " " + foWidth + ",0 ",
        'height': foHeight + tip.h,
        'width': foWidth,
        'fill': 'rgba(0,0,0,0.3)',
        'transform': 'translate(' +( mouseToTooltipPos.y - offset.y )+ ',' +( mouseToTooltipPos.x - offset.x) + ') scale(' + 1/scale[0] + ',' +  1/scale[0] + ')'
    });
  })
  .on('mouseover', function(d) {
    $("#techTreeContainerHint").html(d.hint);
    $("#techTreeContainerHint").css("display","block");

    activeTooltip = {
        'mouseoverTime':Date.now(),
        'elem': d
    };

    
  })
  .on('mouseout', function() {
    $("#techTreeContainerHint").html("");
    $("#techTreeContainerHint").css("display","none");

    activeTooltip = null;
      layer3.selectAll('.svg-tooltip').remove();
      layer3.selectAll('polygon').remove();
  });
  
  // Remove nodes we aren't showing anymore
  node.exit().remove();

  //First draw sibling line with blue line
  var sibl = layer1.selectAll(".sibling").data(siblings);

  sibl.enter().append("path").attr({
                    "class":"sibling",
                    //"marker-end":"url(#" + 'marker_arrow' + ")",
                    //"marker-start":"url(#" + 'marker_circle' + ")",
                });

  sibl.exit().remove();

  sibl.attr("d", sblingLine);

  // Update links
  var link = layer1.selectAll("path.link")

  
      // The function we are passing provides d3 with an id
      // so that it can track when data is being added and removed.
      // This is not necessary if the tree will only be drawn once
      // as in the basic example.
      .data(links, function(d){ return d.target.id; });
  
  // Add new links    
  link.enter().append("path").attr({
                    "marker-end": function(d){ return "url(#" + 'marker_'+ d.target.input_arrow + ")"; },
                    "marker-start": function(d){ return "url(#" + 'marker_'+ d.source.output_arrow + ")"; },
                })
      .attr("class", function(d) { 
        var inputClassLink = d.target.inputClassLink ? d.target.inputClassLink : "";
        var outputClassLink = d.source.outputClassLink ? d.target.outputClassLink : "";
        return "link " + inputClassLink + " " + outputClassLink; 
      })
      ;
/*
    function arcPath(leftHand, d) {
        var start = leftHand ? d.source : d.target,
            end = leftHand ? d.target : d.source,
            dx = end.x - start.x,
            dy = end.y - start.y,
            dr = Math.sqrt(dx * dx + dy * dy),
            sweep = leftHand ? 0 : 1;
        return "M" + start.x + "," + start.y + "A" + dr + "," + dr + " 0 0," + sweep + " " + end.x + "," + end.y;
    }

var textPath = link.append("path")
    .attr("id", function(d) { return d.source.id + "_" + d.target.id; })
    .attr("class", "textpath").attr("d", function(d) {
        return arcPath(d.source.x < d.target.x, d);
      });

var path_label = svg.append("g").selectAll(".path_label")
    .data(links)
  .enter().append("text")
    .attr("class", "path_label")
    .append("svg:textPath")
      .attr("startOffset", "50%")
      .attr("text-anchor", "middle")
      .attr("xlink:href", function(d) { return "#" + d.source.id + "_" + d.target.id; })
      .style("fill", "#000")
      .style("font-family", "Arial")
      .text(function(d) { return d.id; });*/

svg.selectAll("text").data(links).enter()
   .append("text")
   .attr("x", function(d) { 
        var sourceX = d.source.x,
              sourceY = d.source.y + (boxWidth / 2),
              targetX = d.target.x,
              targetY = d.target.y - (boxWidth / 2);
        return sourceY + (targetY -sourceY)/2; 
    })
   .attr("y", function(d) { 
        var sourceX = d.source.x,
              sourceY = d.source.y + (boxWidth / 2),
              targetX = d.target.x,
              targetY = d.target.y - (boxWidth / 2);
        return sourceX + (targetX - sourceX)/2; 
   })
   .text(function(d) { return d.target.label; })
   /*.attr('transform',function(d,i){
            if (d.target.x<d.source.x){
                bbox = this.getBBox();
                rx = bbox.x+bbox.width/2;
                ry = bbox.y+bbox.height/2;
                return 'rotate(0 '+rx+' '+ry+')';
                }
            else {
                return 'rotate(0 180 180)';
                }
        })*/;

/*
 var edgelabels = svg.selectAll(".edgelabel")
        .data(links)
        .enter()
        .append('text')
        .style("pointer-events", "none")
        .attr({'class':'edgelabel',
               'id':function(d,i){return 'edgelabel'+i},
               'dx':80,
               'dy':0,
               'font-size':10,
               'fill':'#aaa'});    

        edgelabels.attr('transform',function(d,i){
            if (d.target.x<d.source.x){
                bbox = this.getBBox();
                rx = bbox.x+bbox.width/2;
                ry = bbox.y+bbox.height/2;
                return 'rotate(180 '+rx+' '+ry+')';
                }
            else {
                return 'rotate(0)';
                }
        });
*/

  layer1.selectAll("path").append('linearGradient');
  layer1.selectAll("path").append('stop')
      .attr('class', 'stop-left')
      .attr('offset', '0');
  layer1.selectAll("path").append('stop')
      .attr('class', 'stop-right')
      .attr('offset', '1');
  
  // Remove any links we don't need anymore
  // if part of the tree was collapsed
  link.exit().remove();
  
  // Update the links positions (old and new)
  link.attr("d", elbow);

}

/**
 * Collapse treeNode (hide their ancestors). We recursively
 * collapse the ancestors so that when the treeNode is
 * expanded it will only reveal one generation. If we don't
 * recursively collapse the ancestors then when
 * the treeNode is clicked on again to expand, all ancestors
 * that were previously showing will be shown again.
 * If you want that behavior then just remove the recursion
 * by removing the if block.
 */
function collapse(treeNode, sourceX, sourceY){
  treeNode.collapsed = true;
}
    
/**
 * Custom path function that creates straight connecting lines.
 * Calculate start and end position of links.
 * Instead of drawing to the center of the node,
 * draw to the border of the treeNode profile box.
 * That way drawing order doesn't matter. In other
 * words, if we draw to the center of the node
 * then we have to draw the links first and the
 * draw the boxes on top of them.
 */
function elbow(d) {

  if (d.target.no_target_parent || d.source.no_child_parent) {

      return "M0,0L0,0";
  }

var sourceX = d.source.x,
      sourceY = d.source.y ,
      targetX = d.target.x,
      targetY = d.target.y;


if (d.target.input_type==="curve" || d.source.output_type==="curve") {
  return diagonal({
                        source: {
                            x: sourceX,
                            y: sourceY
                        },
                        target: {
                            x: targetX,
                            y: targetY
                        },
                    });
}


  return "M" + sourceY + "," + sourceX
    + "H" + (sourceY + (targetY-sourceY)/2)
    + "V" + targetX 
    + "H" + targetY;
}

</script>

<script>
$( document ).ready(function() {

    $(".post-content h1, h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        //console.log(id)
        $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });

    if(!$('#techTreeContainer').length) return;

    $('#techTreeContainer').append("<div id='techTreeContainerHint'></div>");

    var update;
    update = function() {
      requestAnimationFrame(update);
    };
    requestAnimationFrame(update);

    function redraw_techtree() {
      var width = containerWidth;
      var height = containerHeight;
      svgSize.x = containerWidth;
      svgSize.y = containerHeight;

      d3.select("#techTreeContainer").select("svg").attr("width", width)
        .attr("height", height);
      g.attr("width", width)
        .attr("height", height);

      drawTechtree();
    }

    window.addEventListener("resize", redraw_techtree);

    createTechTree($("#techTreeContainer").parent().width(), 500, $("#techTreeContainer").attr("data-id"));
});



</script>

  <body>

    
<header class="site-header py-3 clearfix width-full border-bottom">

  <div class="wrapper">
<div class="site-nav-container flex-justify-between flex-items-center mx-auto">
    <a class="header-logo-invertocat d-flex flex-items-center float-left" href="/flex_docs/">
      <img src="/flex_docs/images/logo.png" alt="logo" title="logo" width="40px">
      <h2 style="color:#3678bd">FlexTool</h2>
    </a>
    <div class="left">
      <a class="site-title" href="/flex_docs/search"><i class="fa fa-search"></i></a>
      <a class="site-title" href="/flex_docs/about"><i class="fa fa-info-circle"></i></a>
      <a class="site-title" href="/flex_docs/category"><i class="fa fa-tags"></i></a>
    </div>

  </div>
</div>
</header>


    <div class="page-content">
      

    <div class="wrapper left">


        <div class="container">
            <nav class="menu">
              <ul>
                <li class="drop-down">
                  <a href="#">Getting Started</a>

                  <div class="mega-menu fadeIn animated">

                    <div class="mm-3column">
                      <span class="categories-list">
                      <ul>
                        <span>Introduction</span>
                          <li><a class="mm-view-more" href="/flex_docs/about/">About</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/community/">Community</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/license/">License</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/release_notes/">Release Notes</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/talks/">Talks and Publications</a></li>
                        </ul>
                      </span>
                    </div>

                    <div class="mm-3column">
                      <span class="categories-list">
                      <ul>
                        <span>Getting Started</span>
                          <li><a class="mm-view-more" href="/flex_docs/download/">Download and install</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/tutorial/">Tutorial</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/test_suite/">Test Suite</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/bug_report/">Bug Reporting</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/faq/">FAQ</a></li>
                        </ul>
                      </span>
                    </div>

                    <div class="mm-3column">
                      <span class="categories-list">
                      <ul>
                        <span>Usage</span>
                          <li><a class="mm-view-more" href="/flex_docs/building_projects/">Building Projects</a></li>
                          <li><a class="mm-view-more" href="/flex_docs/adding_plugins/">Creating new plugins</a></li>
                        </ul>
                      </span>
                    </div>

                </div>

                </li>
                <li>
                  <a href="/flex_docs/plugins/">Plugins</a>
                </li>
                <li>
                  <a href="/flex_docs/api_reference/">API Reference</a>
                </li>
                <li>
                  <a href="/flex_docs/tools_reference/">Tools Reference</a>
                </li>
                <li>
                  <a href="/flex_docs/developer_docs/">Developer docs</a>

                </li>
                <li>
                  <a target="_blank" href="https://github.com/blockspacer/flextool/issues">Github issues</a>
                </li>

              </ul>
            </nav>
          </div>


    </div>

      <div class="wrapper">
        



<div class="search">
    



<form class="form-wrapper" action="/flex_docs/search" method="get">
  <label for="search-box"></label>
  <input type="text" id="search-box" name="query">
  <input type="submit" id="submit" value="Искать">
</form>


<ul id="search-results"></ul>

<script>
  window.store = {
    
      "about": {
        "title": "About",
        "author": "",
        "category": "",
        "content": "flextool is a transpiler that extends C++ for new introspection, reflection and compile-time execution.flextool doesn’t aim to create a predefined set of source code transformations. Users can share C++ scripts (or plugins) for source code transformation.Goal of flextool is to ease usage of community provided scripts (or plugins) while keeping power of Clang LibTooling.flextool also provides extra libraries for plugin developers with functionality not provided by Clang LibTooling:For example:  integration with C++ code interpreter (Cling) allows to write source code transormation rules in original source code file (may be used to execute arbitrary C++ code without need to write and compile plugins).  integration with template engines simplifies usage of Clang LibTooling for purposes of code generation.and many moreFor impatientYou can find usage examples on tutorial pageflextool is build dependencyNote that depending on flextool won’t make users of your application depend on it as well, as it is a pure build dependency, not runtime.MetaprogrammingMetaprogramming is an art of writing programs to treat other programs as their data. This means that a program could generate, read, analyse, and transform code or even itself to achieve a certain solution.Dependency manager for flextool pluginsWe recommend conan - a crossplatform dependency manager for C++.It can be used to install both flextool and all plugins required by flextool into build folder.conan also allows to provide important information in each conan package:      path where flextool executable can be found. You don’t need to install anything system-wide. Just run conan install and you will be able to use flextool!        path to cling and clang header files. That is very usefull cause conan allows to automatically set -I arguments required by clang LibTooling.        path to LLVM_ROOT  Note: It is also possible to install flextool system-wide and provide command-line argumets like --extra-arg=-I$PWD/include --extra-arg=-I$PWD/include/foo --extra-arg=-DMY_DEFINITION=1 --extra-arg=-DONE_MORE_DEFINITION=1 by hand.flextool toolchainflextool uses Clang LibTooling and LLVM to parse source code.Information parsed from source code file will be sent to plugins.Usually plugin is shared library (.so or .dll file). But it is possible to link plugin statically (.a or .lib file) for better optimization. It is also possible to execute arbitrary C++ code at runtime using Cling and use Cling to imitate plugins.FeaturesPlugin can do arbitrary logic with information provided by flextool. For example, you can:      modify source files (implement metaclasses, transpile from C++X to C++Y etc.)        create new files (separate generated class to .hpp and .cpp, etc.)        check source files (implement style checks, validate design patterns, etc.)        compile scripts (rules for code transformations) for maximum performance, not only interpret them in Cling.        use C++ as compile-time scripting language (uses https://github.com/derofim/cling-cmake)        use template engine with full C++ power (transpiles template to valid C++ code, supports Cling, etc.). uses https://github.com/blockspacer/CXTPL  and many moreAbout flex_reflect_pluginDefault plugin https://github.com/blockspacer/flex_reflect_plugin allows to execute custom logic based on data stored in C++ annotations.flex_reflect_plugin can be disabled (as any plugin) or completely replaced with custom plugin(s).For example, annotation starting with “{funccall};” may be used to call C++ logic by some name.__attribute__((annotate(\"{gen};{funccall};make_interface;make_removefuncbody\"))){gen}; - keyword used in every annotation.{funccall}; - keyword used to tell what it must call C++ logic (usually one function) by name.We call functions that can map data stored in annotation to some logic as annotation methods.funccall is annotation method.make_interface;make_removefuncbody - two rules what will be executed. We call them source transformation rules.make_interface and make_removefuncbody - source transformation rules. Rules will be executed from left (make_interface) to right (make_removefuncbody).Usually you don’t need to write long C++ annotations, just use C++ #define (or include built-in header with common defines):// define shortcut#define $apply(...) \\  __attribute__((annotate(\"{gen};{funccall};\" #__VA_ARGS__)))// usage exampleenum class$apply(  reflect_enum)ReflShapeKind0 : uint32_t {  Box = 3,  Sphere = 6,};Suppose we want to morph class into interface:// Sourceclass SomeInterfaceName {  int foo1() {    // ...  };  int foo();  virtual void foobar(int&amp; arg1) = 0;  virtual void zoobar(int&amp; arg2);  virtual ~SomeInterfaceName() = 0;};// &lt;== will be changed into ==&gt;// Resultclass SomeInterfaceName {  virtual int foo1() = 0;  virtual int foo() = 0;  virtual void foobar(int&amp; arg1) = 0;  virtual void zoobar(int&amp; arg2) = 0;  virtual ~SomeInterfaceName() = 0;};We can use funccall action to run C++ scripts for source code transformation. They can be named make_interface and make_removefuncbody (name as you want).Using a similar approach you can apply multiple source code transformation steps to the same class / struct / etc (just list required rules in same annotation like make_interface;make_removefuncbody) .Code repositoryWe prefer to keep main code repository small ( https://github.com/blockspacer/flextool ) and divide project into smaller libraries. Most used library is https://github.com/blockspacer/flexlibAbout libtoolingflextool uses LibTooling to parse and modify C++.LibTooling is a library to support writing standalone tools based on Clang.Useful links:  https://clang.llvm.org/extra/clang-rename.html  Clang Tooling I (add override keyword) https://medium.com/@chichunchen844/clang-tooling-i-add-override-keyword-ddfdf6113b24  llvm-clang-samples https://github.com/eliben/llvm-clang-samples/blob/master/src_clang/tooling_sample.cpp  https://chromium.googlesource.com/chromium/src/+/master/tools/clang/rewrite_to_chrome_style/RewriteToChromeStyle.cpp  http://www.dreamlandcoder.com/system-security/how-i-learned/clang-libtool/  https://jonasdevlieghere.com/understanding-the-clang-ast/  http://swtv.kaist.ac.kr/courses/cs453-fall13/Clang%20tutorial%20v4.pdf  https://meetingcpp.com/mcpp/slides/2019/Teaching%20Old%20Compilers%20New%20Tricks_%20Transpiling%20C++17%20to%20C++11.pdf  https://gist.github.com/riyadparvez/a2c157b24579c6552466  https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-3-rewriting-code-with-clang-tidy/  http://blog.audio-tk.com/2018/03/20/writing-custom-checks-for-clang-tidy/  https://meetingcpp.com/mcpp/slides/2018/Reflection2.pdf  https://s3.amazonaws.com/connect.linaro.org/yvr18/presentations/yvr18-223.pdf  https://kevinaboos.wordpress.com/2013/07/30/clang-tips-and-tricks/  https://eli.thegreenplace.net/tag/llvm-clang  http://www.goldsborough.me/c++/clang/llvm/tools/2017/02/24/00-00-06-emitting_diagnostics_and_fixithints_in_clang_tools/  https://www.amazon.com/Getting-Started-LLVM-Core-Libraries/dp/1782166920  https://variousburglarious.com/tag/clang/About clingflextool uses cling to execute C++ at compile-time.You can use cling for hot code reload / REPL / Fast C++ prototyping / Scripting engine / JIT / etc.Useful links:  (how to add Cling into CMake project) https://github.com/derofim/cling-cmake  https://github.com/root-project/cling/tree/master/www/docs/talks  https://github.com/caiorss/C-Cpp-Notes/blob/master/Root-cern-repl.orgStanding on the Shoulders of GiantsThat project possible because of flexferrum’s autoprogrammer.Articles about flexferrum’s autoprogrammer in media:  [ENG] https://www.youtube.com/watch?v=aPTyatTI42k  [RUS] https://habr.com/ru/article/448466/  [RUS] https://assets.ctfassets.net/oxjq45e8ilak/55bGdX2PnYzmrpM8rwCjcE/791e7eee3236c2023e86e169faca8a0e/Sergei_Sadovnikov_Metaclasses_in_C___dream_Reality.pdfLicenseNote: This project is provided as it is, without any warranty (see License).LICENSE for open source componentsAll the open source components are used under their associated open source licences.Used open source components:  icu  ced  boost  harfbuzz  boost.outcome  chromium (base)  libevent  modp_b64  tcmalloc  xdg_mime  xdg_user_dirs  dynamic_annotations  (Facebook) Folly  (Microsoft) GSLSee LICENSE files📋 Similar projects  https://github.com/cppreflect/metapp  https://github.com/flexferrum/autoprogrammer/blob/8c9867d357450b99202dac81730851ffc8faa891/src/generators/pimpl_generator.cpp  Clava https://github.com/specs-feup/clava  Compile-time EXecution of C++ code https://github.com/MaliusArth/cex/blob/6f6e700a253b06c7ae6801e1a3c1f3d842931d77/tool/src/MatchCallbacks/AnnotatedFunctionCallback.cpp  circle https://github.com/seanbaxter/circle/blob/master/examples/README.md  SugarCpp https://github.com/curimit/SugarCpp  ExtendedCpp https://github.com/reneeichhorn/extended-cpp  https://github.com/dobkeratops/compiler  transpiling_cpp17_to_cpp11 https://github.com/neobrain/cftf  https://github.com/llvm-mirror/clang-tools-extra/blob/388528d/clang-tidy/add_new_check.py  https://github.com/aantron/better-enums  https://github.com/Neargye/magic_enum  https://github.com/foonathan/standardese  https://github.com/Leandros/metareflect/blob/0208fdd4fc0ea1081ae2ff4c3bfce161305a7423/README.md#run-the-metareflect-tool  https://github.com/qtinuum/QtnProperty#overview  https://github.com/p-ranav/pprint  https://github.com/google/draco/blob/master/CMakeLists.txt#L715  https://github.com/goto40/rpp/blob/ec8a4c4a3ac32dccee8c4e8ba97be8c2ba1c8f88/src/parser/common_parser.cpp#L21  More https://gist.github.com/blockspacer/6f03933de4f9a6c920649713b056ba4a",
        "url": "/flex_docs/about/"
      }
      ,
    
      "adding-plugins": {
        "title": "adding_plugins",
        "author": "",
        "category": "",
        "content": "AboutThat page provides information about plugin development for flextool.Example project: flex_meta_pluginGithub repository: https://github.com/blockspacer/flex_meta_pluginUses conanfile and CMakeLists.txt to integrate with flextoolExample project: flex_meta_demoGithub repository: https://github.com/blockspacer/flex_meta_demoPlugin provides rules for source code transformation and generation.Example project: flex_typeclass_pluginGithub repository: https://github.com/blockspacer/flex_typeclass_pluginUses conanfile and CMakeLists.txt to integrate with flextool. Plugin provides support for typeclasses (or Rust-like traits or “TEPS” - “Type Erasure Parent Style” or virtual concepts).How to create new plugins for flextoolDefault plugin https://github.com/blockspacer/flex_reflect_plugin allows to execute custom logic based on data stored in C++ annotations. flex_reflect_plugin can be disabled (as any plugin) or completely replaced with custom plugin(s). Tutorial below assumes that you use flex_reflect_plugin.Suppose you want to create custom C++ annotation (like [[make_reflect]]) and perform some actions with annotated code.Any plugin can add custom rules for source code transformation or generation during Events::RegisterAnnotationMethodsExample:    ::clang_utils::SourceTransformPipeline&amp; sourceTransformPipeline      = *event.sourceTransformPipeline;    ::clang_utils::SourceTransformRules&amp; sourceTransformRules      = sourceTransformPipeline.sourceTransformRules;    sourceTransformRules[\"make_reflect\"] =      base::BindRepeating(        &amp;AnnotationPipeline::make_reflect,        base::Unretained(this));make_reflect (from sourceTransformRules[\"make_reflect\"]) can be used as part of annotation attribute:// make_reflect can be used with some other rules, for example: make_interface;make_removefuncbody__attribute__((annotate(\"{gen};{funccall};make_reflect;make_interface;make_removefuncbody\")))Code below allows to bind C++ function &amp;AnnotationPipeline::make_reflect with string make_reflect:    sourceTransformRules[\"make_reflect\"] =      base::BindRepeating(        &amp;AnnotationPipeline::make_reflect,        base::Unretained(this));Where C++ function &amp;AnnotationPipeline::make_reflect can use clang LibTooling to parse or modify source code. You can save information about parsed code in files, transfer parsed information over network, etc.We created custom C++ annotation. But how to get information about annotated code? - &amp;AnnotationPipeline::make_reflect must recieve information about used annotation attribute in const clang_utils::SourceTransformOptions&amp;.    // must point to record associated with annotation attribute    // __attribute__((annotate(\"{gen};{funccall};make_reflect;...\")))    clang::CXXRecordDecl const *record =        sourceTransformOptions.matchResult.Nodes        .getNodeAs&lt;clang::CXXRecordDecl&gt;(\"bind_gen\");For example, we can print record name:    if (record) {      LOG(INFO)        &lt;&lt; \"record name is \"        &lt;&lt; record-&gt;getNameAsString().c_str();    }Usage example below prints SomeStructName as record name (using record-&gt;getNameAsString()):#include &lt;string&gt;#include &lt;vector&gt;struct  $apply(    make_reflect  )SomeStructName { public:  SomeStructName() {    // ...  } private:  __attribute__((annotate(\"{gen};{attr};reflectable;\")))  std::vector&lt;std::string&gt; m_VecStr2;};We can iterate all fields in SomeStructName and print them (example below prints std::vector&lt;std::string&gt; m_VecStr2):for (clang::Decl *decl : record-&gt;decls()) {    if (clang::FieldDecl *field = llvm::dyn_cast&lt;clang::FieldDecl&gt;(decl)) {        LOG(INFO)            &lt;&lt; \"field type is\"            &lt;&lt; field-&gt;getType().getUnqualifiedType().getAsString().c_str()            &lt;&lt; \" and field name is \"            &lt;&lt; field-&gt;getNameAsString().c_str();    }}Note that we used clang::FieldDecl *field = llvm::dyn_cast&lt;clang::FieldDecl&gt;(decl). That code used clang LibTooling. You can find a lot of information about LibTooling over the internet, example video Building a C++ Reflection System: Using LLVM and Clang: https://www.youtube.com/watch?v=DUiUBt-fqEYWhat if we don’t want to print information about some fields?We can add custom annotation near some fields similar to __attribute__((annotate(\"{gen};{attr};reflectable;\"))). That annotation can be used to filter fields using some data, in our case it is {attr};reflectable. Example below can parse annotate-&gt;getAnnotation() to perform custom actions.if ( auto annotate = decl-&gt;getAttr&lt;clang::AnnotateAttr&gt;() ){    std::string annotationCode =      annotate-&gt;getAnnotation().str();    LOG(INFO)        &lt;&lt; \"annotation code: \"        &lt;&lt; annotationCode;    // ... parse |std::string annotationCode| and return true if it is valid ...}Can we add information about fields of SomeStructName at the end of SomeStructName?Suppose we want to add new field with reflection data at the end of the SomeStructName and store that data in static std::map&lt;std::string, std::string&gt; fields.We can iterate all fields and generate C++ code:      for(const auto&amp; [key, value] : fields) {        output.append(indent                        + indent + \"{ \");        output.append(\"\\\"\" + key + \"\\\"\");        output.append(\", \");        output.append(\"\\\"\" + value + \"\\\"\");        output.append(\" }\");        output.append(\"\\n\");      }For simplisity we did not use template engine. You can integrate with any template engine to avoid code like output.append(\"\\n\");. You may want to use template engine provided by https://github.com/blockspacer/flex_squarets_plugin.We can save generated code (stored in variable output) at the end of SomeStructName:      auto locEnd = record-&gt;getLocEnd();      // add new field with reflection data at the end of the C++ record      sourceTransformOptions.rewriter.InsertText(locEnd, output,        /*InsertAfter=*/true, /*IndentNewLines*/ false);flextool will save file with all source code transformations applied, including rewriter.InsertText. flextool will save file with .generated extention, but user can provide custom path for each generated file.You can find full code of demo project at https://github.com/blockspacer/flex_meta_plugin/For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/adding_plugins/"
      }
      ,
    
      "api-reference": {
        "title": "api_reference",
        "author": "",
        "category": "",
        "content": "API DocumentationAPI Documentation can be generated based on comments in source codeFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/api_reference/"
      }
      ,
    
      "bug-report": {
        "title": "bug_report",
        "author": "",
        "category": "",
        "content": "Bug reports can be posted in the GitHub Issue Tracker https://github.com/blockspacer/flextool/issuesPlease supply as much relevant information as possible, including:  Used version  Original source code.  Used plugins  Environment information including compiler versions  Error symptoms.  Proposed solutions, ideally with a pull request.How to debug in case of crash or bugsBuild with -s build_type=DebugYou can manually run some app_name under gdb debugger https://www.gnu.org/software/gdb/gdb -ex \"r\" -ex \"bt\" --args app_name .........How to increase log levelAdd command-line arguments:--vmodule=*main*=100,*=200 --enable-logging=stderr --log-level=100see https://www.chromium.org/for-testers/enable-loggingHow to capture trace reportAdd command-line arguments:--start_tracing --tracing_categories=*,disabled-by-default-memory-infraAfter app close event trace report will be saved into json file.You can view saved trace report in chrome://tracing/seehttps://aras-p.info/blog/2017/01/23/Chrome-Tracing-as-Profiler-Frontend/https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/trace-event-readinghttps://www.chromium.org/developers/how-tos/trace-event-profiling-toolhttps://www.chromium.org/developers/how-tos/trace-event-profiling-tool/using-frameviewerhttps://slack.engineering/chrome-tracing-for-fun-and-profit-a15ec83aa908Currently tool does not support compilation databaseCurrently tool does not support compilation database, so ignore warning about missing compilation databaseDebugging with Sanitizersthat page in developmentProfiling performancethat page in developmentSite and documentation bugsDocumentation (site) bugs should be filed in the same Issue Tracker.Include relevant information including:  The URL and title of the affected page(s).  A description of the problem.  Suggestions for a possible solution.For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/bug_report/"
      }
      ,
    
      "building-projects": {
        "title": "building_projects",
        "author": "",
        "category": "",
        "content": "AboutThat page provides information about flextool integration with C++ projects.Example project: flex_meta_demoGithub repository: https://github.com/blockspacer/flex_meta_demoUses conanfile and CMakeLists.txt to integrate with flextoolAdding flextool to conanfile and CMakeLists.txtMake sure you installed flextool using conan. You can find installation instructions in README.md at https://github.com/blockspacer/flextoolIf you built flextool using conan create, than flextool must be in output of command conan search flextoolMake sure that your project uses conanfile.py. See https://docs.conan.io/en/latest/mastering/conanfile_py.html for detailsAdd in conanfile.py:      self.requires(\"flextool/master@conan/stable\")Run conan install. See https://docs.conan.io/en/latest/using_packages/conanfile_txt.html for detailsNow you can use flextool in CMakeLists.txt of your projectAdd in CMakeLists.txt:list(APPEND CMAKE_PROGRAM_PATH ${CONAN_BIN_DIRS})find_package(flextool MODULE REQUIRED)find_program(flextool flextool NO_SYSTEM_ENVIRONMENT_PATH NO_CMAKE_SYSTEM_PATH)message(STATUS \"find_program for flextool ${flextool}\")if(${flextool} STREQUAL \"\")    message(FATAL_ERROR \"flextool not found ${flextool}\")endif()Run configure step for your cmake based project. See https://cmake.org/cmake/help/latest/guide/tutorial/index.html for detailsMake sure that added message prints valid path to flextool installed using conan package manager.Now you can use execute_process to run ${flextool} using cmake with desired arguments.Example that prints version of flextool:# NOTE: You may want to generate files only if some source files were changed, so prefer `add_custom_command` with `DEPENDS` to `execute_process`execute_process(  COMMAND ${flextool}          --version  RESULT_VARIABLE retcode  ERROR_VARIABLE _ERROR_VARIABLE)if(NOT \"${retcode}\" STREQUAL \"0\")  message(FATAL_ERROR \"Bad exit status ${retcode} ${_ERROR_VARIABLE}\")endif()message(STATUS \"flextool output: ${retcode} ${_ERROR_VARIABLE}\")You can find full code of example project at https://github.com/blockspacer/flex_meta_demo/blob/master/CMakeLists.txtAdding existing plugins to conanfile and CMakeLists.txtflextool uses plugins to execute custom logic while parsing code using clang LibTooling.Make sure that your project uses conanfile.py. See https://docs.conan.io/en/latest/mastering/conanfile_py.html for detailsAdd in conanfile.py:      self.requires(\"flex_reflect_plugin/master@conan/stable\")      self.requires(\"flex_meta_plugin/master@conan/stable\")      self.requires(\"flex_support_headers/master@conan/stable\")Where flex_meta_plugin is plugin example that can be found at https://github.com/blockspacer/flex_meta_pluginWhere flex_reflect_plugin is plugin example that can be found at https://github.com/blockspacer/flex_reflect_pluginWhere flex_support_headers is header-only library that can simplify usage of Cling C++ interpreter with flextool. flex_support_headers can be found at https://github.com/blockspacer/flex_support_headersMake sure you installed flex_reflect_plugin, flex_meta_plugin and flex_support_headers using conan. You can find installation instructions in README.md at https://github.com/blockspacer/flex_meta_plugin, https://github.com/blockspacer/flex_support_headers and  https://github.com/blockspacer/flex_support_headersNote that plugins can depend on each other, so order of conan create may be important (or you will get build errors).If you built flextool using conan create, than flextool must be in output of command conan search flextool. Same must apply for plugins, example: conan search flex_meta_pluginRun conan install. See https://docs.conan.io/en/latest/using_packages/conanfile_txt.html for detailsNow cmake must be able to find path for installed pluginsAdd in CMakeLists.txt:set(flex_reflect_plugin  ${CONAN_FLEX_REFLECT_PLUGIN_ROOT}/lib/flex_reflect_plugin${CMAKE_SHARED_LIBRARY_SUFFIX})message(STATUS \"flex_reflect_plugin=${flex_reflect_plugin}\")Run configure step for your cmake based project. See https://cmake.org/cmake/help/latest/guide/tutorial/index.html for detailsMake sure that added message prints valid path to flex_reflect_plugin installed using conan package manager.You can pass command-line argument --load_plugin to flextool that must conatain path to plugin file. We use ${CMAKE_SHARED_LIBRARY_SUFFIX} that is suffix to use for the end of a shared library filename, .dll on Windows, .so on Linux.Usage example:# NOTE: You may want to generate files only if some source files were changed, so prefer `add_custom_command` with `DEPENDS` to `execute_process`execute_process(  COMMAND ${flextool}          --indir=${CMAKE_CURRENT_SOURCE_DIR}          --outdir=${flextool_outdir}          --load_plugin ${flex_reflect_plugin}          --load_plugin ${flex_meta_plugin}          --extra-arg=-I${cling_includes}          --extra-arg=-I${clang_includes}          --extra-arg=-I${chromium_base_headers}          --extra-arg=-I${chromium_build_util_headers}          --extra-arg=-I${basis_headers}          --extra-arg=-I${flexlib_headers}          --extra-arg=-I${flextool_outdir}          --extra-arg=-Wno-undefined-inline          ${flextool_extra_args}          ${flextool_input_files}          --cling_scripts=${flex_support_headers}          #TIMEOUT 7200 # sec  RESULT_VARIABLE retcode  ERROR_VARIABLE _ERROR_VARIABLE)if(NOT \"${retcode}\" STREQUAL \"0\")  message(FATAL_ERROR \"Bad exit status ${retcode} ${_ERROR_VARIABLE}\")endif()message(STATUS \"flextool output: ${retcode} ${_ERROR_VARIABLE}\")# Set GENERATED properties of your generated source file.# So cmake won't complain about missing source file.set_source_files_properties(  ${generated_files}  PROPERTIES GENERATED 1)Make sure you changed ${flextool_outdir} to directory path where generated files must be stored.You may want to generate files only if some source files were changed, so prefer add_custom_command with DEPENDS to execute_process:# you can link with library via --extra-arg=-l# example: --extra-arg=-l${flexlib_file}add_custom_command(    OUTPUT ${generated_typeclasses}    # code generator COMMAND will only be launched    # if some of DEPENDS files were changed.    DEPENDS      ${flextool_input_files}    COMMAND      ${CMAKE_COMMAND} -E echo \" Removing ${generated_typeclasses}.\"    COMMAND      ${CMAKE_COMMAND} -E remove ${generated_typeclasses}    COMMAND      ${flextool}        --vmodule=*=200 --enable-logging=stderr --log-level=100        --indir=${CMAKE_SOURCE_DIR}        --outdir=${flextool_outdir}        --load_plugin=${flex_squarets_plugin}        #--load_plugin=${flex_meta_plugin}        --load_plugin=${flex_reflect_plugin}        --load_plugin=${${LIB_NAME}_file}        --extra-arg=-I${cling_includes}        --extra-arg=-I${clang_includes}        --extra-arg=-I${corrade_includes}        --extra-arg=-I${entt_includes}        # NOTE: Cling does not support compile_commands.json        # so we must add headers used by `flex_support_headers` package        # place into `flex_support_headers` includes that can be used by Cling        --extra-arg=-I${chromium_base_headers}        --extra-arg=-I${chromium_build_util_headers}        --extra-arg=-I${basis_headers}        --extra-arg=-I${flexlib_headers}        --extra-arg=-I${flextool_outdir}        --extra-arg=-DCLING_IS_ON=1        # path to tests/example_datatypes.hpp        --extra-arg=-I${CMAKE_CURRENT_SOURCE_DIR}        --extra-arg=-Wno-undefined-inline        ${flextool_extra_args}        ${flextool_input_files}        # cling_scripts must be ending argument        --cling_scripts=${flex_support_headers}        --cling_scripts=${flex_typeclass_plugin_settings}    DEPENDS ${LIB_NAME} ${ROOT_PROJECT_LIB} ${${LIB_NAME}_file}    COMMENT \"running ${flextool}\"    VERBATIM # to support \\t for example)You can find full code of example project at https://github.com/blockspacer/flex_meta_demo/blob/master/CMakeLists.txtYou can also find useful CMakeLists.txt from flex_typeclass_plugin at https://github.com/blockspacer/flex_typeclass_plugin/blob/master/CMakeLists.txtRunning flextool from conanfileUsually you want to execute flextool as part of build or configure step using CMakeLists.txtBut if you want to test plugin created for flextool, than you can run flextool as part of test_package/conanfile.pyYou can find full code at https://github.com/blockspacer/flex_meta_plugin/blob/master/test_package/conanfile.py    def test(self):        if not tools.cross_building(self.settings):            self.output.info('self.source_folder = %s' % (self.source_folder))            ext = \".so\" if os_info.is_linux else \".dll\"            #            flex_reflect_plugin_ROOT = self.deps_cpp_info[\"flex_reflect_plugin\"].rootpath            flex_reflect_plugin_file = flex_reflect_plugin_ROOT            flex_reflect_plugin_file = os.path.join(flex_reflect_plugin_file, \"lib\")            flex_reflect_plugin_file = os.path.join(flex_reflect_plugin_file, \"flex_reflect_plugin\" + ext)            self.output.info('flex_reflect_plugin_file = %s' % (flex_reflect_plugin_file))            #            flex_meta_plugin_ROOT = self.deps_cpp_info[\"flex_meta_plugin\"].rootpath            flex_meta_plugin_file = flex_meta_plugin_ROOT            flex_meta_plugin_file = os.path.join(flex_meta_plugin_file, \"lib\")            flex_meta_plugin_file = os.path.join(flex_meta_plugin_file, \"flex_meta_plugin\" + ext)            self.output.info('flex_meta_plugin_file = %s' % (flex_meta_plugin_file))            #            # cling_includes must point to cling/Interpreter/RuntimeUniverse.h            cling_conan_ROOT = self.deps_cpp_info[\"cling_conan\"].rootpath            cling_includes = cling_conan_ROOT            cling_includes = os.path.join(cling_includes, \"include\")            self.output.info('cling_includes = %s' % (cling_includes))            #            # clang_includes must point to stddef.h from lib/clang/5.0.0/include            clang_includes = cling_conan_ROOT            clang_includes = os.path.join(clang_includes, \"lib\")            clang_includes = os.path.join(clang_includes, \"clang\")            clang_includes = os.path.join(clang_includes, \"5.0.0\")            clang_includes = os.path.join(clang_includes, \"include\")            self.output.info('clang_includes = %s' % (clang_includes))            #            flextool_cmd = \"flextool\" \\              \" --outdir .\" \\              \" --indir .\" \\              \" --load_plugin {}\" \\              \" --load_plugin {}\" \\              \" --extra-arg=-I{}\" \\              \" --extra-arg=-I{}\" \\              \" {}/main.cpp\".format(              flex_reflect_plugin_file, flex_meta_plugin_file, cling_includes, clang_includes, self.source_folder)            self.output.info('flextool_cmd = %s' % (flextool_cmd))            self.run(flextool_cmd, run_environment=True)For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/building_projects/"
      }
      ,
    
      "common": {
        "title": "common",
        "author": "",
        "category": "",
        "content": "Useful links  Tutorial  Usage  Plugins  Tracing and log levelsFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/common/"
      }
      ,
    
      "community": {
        "title": "community",
        "author": "",
        "category": "",
        "content": "Welcome to the flextool community!Get in touchThe best ways contact the community are:The GitHub Issue Tracker https://github.com/blockspacer/flextool/issuesFeel free to ask questions, share your ideas, or just join the conversation!For contibutorsFell free to open GitHub Issue if you know how to improve that page or add new communication methods (for example, IRC)",
        "url": "/flex_docs/community/"
      }
      ,
    
      "developer-docs": {
        "title": "developer_docs",
        "author": "",
        "category": "",
        "content": "AboutThis section contains articles that are relevant to anyone who wants to contribute and help improve the project.Contributing provides an introduction to contributing, along with a few ideas for how you can help.The Developer’s Guide contains contributor-relevant information, covering compiler operation and submitting patches to the repositories.If you contribute you must accept the project’s open source licenses (MIT)!Code styleWe use Chromium C++ style guide https://www.chromium.org/developers/coding-styleC++ Banned Language FeaturesWe use Chromium Banned Language Features https://chromium-cpp.appspot.com/chromium/baseWe use fork of chromium/base.Original chromium/base, also contains docs: https://github.com/chromium/chromium/tree/master/baseFork used by us: https://github.com/blockspacer/chromium_base_conanDeveloper docsBecause we use fork of chromium/base - chromium docs may be usefulhttps://www.chromium.org/developershttps://github.com/chromium/chromium/tree/master/docsFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/developer_docs/"
      }
      ,
    
      "faq": {
        "title": "faq",
        "author": "",
        "category": "",
        "content": "TODOadd info about build with dockerTODOthat page in developmentFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/faq/"
      }
      ,
    
      "download": {
        "title": "download",
        "author": "",
        "category": "",
        "content": "Cloning and setupgit clone https://github.com/blockspacer/flextool.gitIf you got errors after git clone - try to update submodulesgit submodule sync --recursive# orgit fetch --recurse-submodules# orgit submodule update --init --recursive --depth 100 --progress# orgit submodule update --force --recursive --init --remoteInstall C++ compiler: gccExample of installation steps, tested on ubuntu 18.04:apt install -y build-essentialInstall C++ compiler: clangExample of installation steps, tested on ubuntu 18.04:apt install -y clang-6.0 libstdc++6Install CMakeYou can find latest version on https://cmake.org/Example of installation steps, tested on ubuntu 18.04:# NOTE: github may be down, so prefer cmake.org/files# see https://anglehit.com/how-to-install-the-latest-version-of-cmake-via-command-line/version=3.15build=3mkdir ~/temp || truecd ~/tempwget --no-check-certificate https://cmake.org/files/v$version/cmake-$version.$build.tar.gztar -xzvf cmake-$version.$build.tar.gzcd cmake-$version.$build/./bootstrapmake -j4make installcmake --versionInstall conan - a crossplatform dependency manager for C++pip install --index-url=https://pypi.python.org/simple/ --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org wheel \\  &amp;&amp; \\  pip install --index-url=https://pypi.python.org/simple/ --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org virtualenv \\  &amp;&amp; \\  pip install --index-url=https://pypi.python.org/simple/ --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org conan \\  &amp;&amp; \\  pip install --index-url=https://pypi.python.org/simple/ --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org conan_package_tools# optional - create default profileconan profile new default --detect# validate `conan remote list`conan remote list# validate `conan search`conan search *boost* -r allConfigure Proxies &amp; cacert_path in ~/.conan/conan.conf, see https://docs.conan.io/en/latest/reference/config_files/conan.conf.html#proxiesConfigure conan clang profile ~/.conan/profiles/clang to then use –profile clang:/usr/bin/clang-6.0 -v/usr/bin/clang++-6.0 -v# nano is text editornano ~/.conan/profiles/clang[settings]# We are building in Ubuntu Linuxos_build=Linuxos=Linuxarch_build=x86_64arch=x86_64compiler=clangcompiler.version=6.0compiler.libcxx=libstdc++11[env]CC=/usr/bin/clang-6.0CXX=/usr/bin/clang++-6.0Configure conan clang profile ~/.conan/profiles/gcc to then use –profile gcc:/usr/bin/gcc -v/usr/bin/g++ -v# nano is text editornano ~/.conan/profiles/gcc[settings]# We are building in Ubuntu Linuxos_build=Linuxos=Linuxarch_build=x86_64arch=x86_64compiler=gcccompiler.version=7compiler.libcxx=libstdc++11[env]CC=/usr/bin/gccCXX=/usr/bin/g++Add conan remotesTo be able to add the list of dependency remotes please type the following command:cmake -E time conan config install conan/remotes/# OR:# cmake -E time conan config install conan/remotes_disabled_ssl/(optional) If you want to disable ssl (under proxy, etc.)# see https://docs.conan.io/en/latest/reference/commands/misc/remote.html#conan-remoteconan remote update conan-center https://conan.bintray.com Falseconan search boost* -r=conan-centerconan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conanconan remote update bincrafters https://api.bintray.com/conan/bincrafters/public-conan Falseconan search boost* -r=bincraftersIf you want to set corp. cacert:CONAN_CACERT_PATH=/path/to/ca-bundle.crtfile $CONAN_CACERT_PATHUseful links:  https://ncona.com/2019/04/dependency-management-in-cpp-with-conan/  https://blog.conan.io/2018/06/11/Transparent-CMake-Integration.html  Conan https://blog.conan.io/2018/06/11/Transparent-CMake-Integration.html https://blog.conan.io/2018/12/03/Using-Facebook-Folly-with-Conan.html  CONAN_PKG::cppzmq https://github.com/chaplin89/prontocpp/blob/master/CMakeLists.txt#L42  https://github.com/conan-io/examplesBuild dependenciesWe use tools/buildConanThirdparty.cmake script. It just downloads dependencies and runs conan createwith provided conan options# NOTE: don't forget to re-run `conan install` after command below# NOTE: change `build_type=Debug` to `build_type=Release` in productioncmake -DEXTRA_CONAN_OPTS=\"--profile;clang;-s;build_type=Debug;--build;missing\" -P tools/buildConanThirdparty.cmakeNOTE: dependencies include big codebases like cling and LLVM. Build from source can take a lot of processor time.For contributors: conan allows to provide pre-built packages. Please open GitHub Issue if no pre-built packages are available for your platform.Build extra dependenciesSome dependencies are not provided by tools/buildConanThirdparty.cmake script.  type_safeconan remote add Manu343726 https://api.bintray.com/conan/manu343726/conan-packages Falsegit clone http://github.com/foonathan/type_safe.git -b v0.2.1cd type_safe# NOTE: change `build_type=Debug` to `build_type=Release` in productionCONAN_REVISIONS_ENABLED=1 \\    CONAN_VERBOSE_TRACEBACK=1 \\    CONAN_PRINT_RUN_COMMANDS=1 \\    CONAN_LOGGING_LEVEL=10 \\    GIT_SSL_NO_VERIFY=true \\    conan create . conan/stable -s build_type=Debug --profile clang --build missing  corrade# NOTE: change `build_type=Debug` to `build_type=Release` in productiongit clone http://github.com/mosra/corrade.git &amp;&amp; cd corradeCONAN_REVISIONS_ENABLED=1 \\    CONAN_VERBOSE_TRACEBACK=1 \\    CONAN_PRINT_RUN_COMMANDS=1 \\    CONAN_LOGGING_LEVEL=10 \\    GIT_SSL_NO_VERIFY=true \\    conan create . magnum/stable -s build_type=Debug --profile clang --build missing -tf package/conan/test_packageBuild flextoolRun conan create as stated in (latest instructions on github.com) https://github.com/blockspacer/flextool#installationexport CXX=clang++-6.0export CC=clang-6.0# NOTE: change `build_type=Debug` to `build_type=Release` in production# NOTE: use --build=missing if you got error `ERROR: Missing prebuilt package`CONAN_REVISIONS_ENABLED=1 \\CONAN_VERBOSE_TRACEBACK=1 \\CONAN_PRINT_RUN_COMMANDS=1 \\CONAN_LOGGING_LEVEL=10 \\GIT_SSL_NO_VERIFY=true \\    cmake -E time \\      conan create . conan/stable \\      -s build_type=Debug -s cling_conan:build_type=Release \\      --profile clang \\          -o flextool:enable_clang_from_conan=False \\          -e flextool:enable_tests=TrueVerifying the installationIf you built flextool using conan create, than flextool must be in output of command conan search flextoolUpdatingUse conan create or conan install as usual, see for details https://docs.conan.io/en/latest/developing_packages/package_dev_flow.htmlUninstallingUse conan remove as usual, see for details https://docs.conan.io/en/latest/reference/commands/misc/remove.htmlSystem-wide installation using conanthat page in developmentFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/download/"
      }
      ,
    
      "faq": {
        "title": "faq",
        "author": "",
        "category": "",
        "content": "MotivationWhy wouldn’t you just extend clang since it also provides some experimental features (modules for instance)?Clang is a compiler while this project is a transpiler, that transforms code to standardized c++ code without the need to modify llvm/assembly.Because the tool’s output is C++ code, you can compile transpiled code using emscripten, use static code analyzers, run code inside cling etc.",
        "url": "/flex_docs/faq/"
      }
      ,
    
      "flexlib": {
        "title": "flexlib",
        "author": "",
        "category": "",
        "content": "We prefer to keep main code repository small ( https://github.com/blockspacer/flextool ) and divide project into smaller libraries. Most used library is https://github.com/blockspacer/flexlibFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/flexlib/"
      }
      ,
    
      "flextool": {
        "title": "flextool",
        "author": "",
        "category": "",
        "content": "flextool is a transpiler that extends C++ for new introspection, reflection and compile-time execution.For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/flextool/"
      }
      ,
    
      "license": {
        "title": "license",
        "author": "",
        "category": "",
        "content": "Open Source License: the MIT licenseMIT license is well known and understood.The current full licence can be found on GitHub. See https://github.com/blockspacer/flextool/blob/master/LICENSEAll the open source components are used under their associated open source licences. See LICENSE filesNote that community-provided plugins can have custom license.",
        "url": "/flex_docs/license/"
      }
      ,
    
      "plugins": {
        "title": "plugins",
        "author": "",
        "category": "",
        "content": "AboutThat page provides information about some existing plugins for flextool.You can find information about plugin development at Creating new pluginsYou can find information about usage of existing plugins at Usageflex_reflect_pluginProvides annotation methods:  Call function (arbitrary logic) by some name  Execute C++ code at runtime using Cling C++ interpreterGithub repository: https://github.com/blockspacer/flex_reflect_pluginflex_meta_demoExample projectGithub repository: https://github.com/blockspacer/flex_meta_demoflex_typeclass_pluginGithub repository: https://github.com/blockspacer/flex_typeclass_pluginUses conanfile and CMakeLists.txt to integrate with flextool. Plugin provides support for typeclasses (or Rust-like traits or “TEPS” - “Type Erasure Parent Style” or virtual concepts).For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/plugins/"
      }
      ,
    
      "release-notes": {
        "title": "release_notes",
        "author": "",
        "category": "",
        "content": "master git branchmaster git branch must contain stable, well tested code.For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/release_notes/"
      }
      ,
    
      "talks": {
        "title": "talks",
        "author": "",
        "category": "",
        "content": "AboutThat page must contain some talks and publications about flextoolLibToolingflextool uses Cling LibTooling, so talks about LibTooling may be useful:Building a C++ Reflection System: Using LLVM and Clang: https://www.youtube.com/watch?v=DUiUBt-fqEYautoprogrammerflextool is inspired by https://github.com/flexferrum/autoprogrammer, so talks about autoprogrammer may be useful:Automatic C++ source code generation with clang - Sergei Sadovnikov ACCU 2017For contibutorsFell free to open GitHub Issue if you know how to improve that page or add more publications (for example, CppCon presentations)",
        "url": "/flex_docs/talks/"
      }
      ,
    
      "test-suite": {
        "title": "test_suite",
        "author": "",
        "category": "",
        "content": "AboutThat page must contain information about test suiteFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/test_suite/"
      }
      ,
    
      "tools-reference": {
        "title": "tools_reference",
        "author": "",
        "category": "",
        "content": "AboutThat page must contain information about flextool command-line argumentsflextool uses boost::program_optionsYou can find list of all command-line options in https://github.com/blockspacer/flextool/blob/master/src/app_cmd_options.ccFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/tools_reference/"
      }
      ,
    
      "tutorial": {
        "title": "tutorial",
        "author": "",
        "category": "",
        "content": "First things firstMake sure you have downloaded and installed flextool (the exact approach for doing this will depend your operating system: Linux, Windows, or Mac).See for detailed installation instructions /flex_docs/download/Running flextool using conan and CMakeSee for detailed usage instructions /flex_docs/building_projects/IntroductionThere are some boilerplate code in many projects:  Enum to string conversion (and vice versa)  Editor integration (UE4, Unity, Godot)  Serialization/deserialization  Object RPC and proxy/stubs  ORM  GUI controls binding and models        How flextool works:  It takes a piece of handwritten regular C++ code  It parses this code with the Clang LibTooling  It analyses the parsing result and produces another piece of code (or performs custom actions defined by plugins)Using flex_typeclass_plugin to add custom C++ typeclasses (using Type Erasure)Type Erasure - Combination of static and dynamic polymorphism which gets the best of both sides with minimal overhead.Definition by Dave Abrahams and Aleksey Curtovoy in, C++ Template Metaprogramming:  In its fullest expression, type erasure is the process of turning a wide variety of types with a common interface into one type with that same interfaceQuotes from https://dragly.org/2018/04/21/rust-like-traits-in-cpp/  With inheritance in C++, it is easy to introduce new types,but hard to extend with new functionality(all existing types will need to implement any new functions).  Further, it is hard to add functionality after-the-fact.If a library has defined length() as a function of Vector3,but you need lengthSquared() for performance reasons,there is no easy way to add this to the Vector3 class.  You will typically have to make lengthSquared(Vector3 v)a free function, which makes it awkward,because you are now calling v.length() for the length,but lengthSquared(v) for the length squared.Quote from https://quuxplusone.github.io/blog/2019/03/18/what-is-type-erasure/#i-mean-ad-hoc-dynamic-polymorphism  When I say “type erasure” in C++, I mean more than just a base class with a classical polymorphic interface.  I mean a non-virtual interface which encapsulates and hides the polymorphism from the end-user, and allows them to use “duck typing” without bothering to inherit from any library class. (This can allow several libraries to interoperate seamlessly, even if they don’t know about each other’s code.)You can find more information about Type Erasure as design pattern at https://caiorss.github.io/C-Cpp-Notes/cpp-design-patterns.html#orgdda5854You can find more information about implementation details of Type Erasure at https://www.modernescpp.com/index.php/c-core-guidelines-type-erasure-with-templates and http://www.goldsborough.me/cpp/2018/05/22/00-32-43-type_erasure_for_unopinionated_interfaces_in_c++/ and https://mropert.github.io/2017/11/30/polymorphic_ducks/You can also find interesting section about type erasure from the book Hands-On Design Patterns with C++In C++ Rust-like-traits are usually called as typeclasses (similar to Haskell https://functionalcpp.wordpress.com/2013/08/16/type-classes/). You can find example code that uses typeclasses at https://github.com/TartanLlama/typeclassesAlso typeclasses may be called as virtual concepts, see for details https://github.com/andyprowl/virtual-concepts/blob/master/draft/Dynamic%20Generic%20Programming%20with%20Virtual%20Concepts.pdf and https://cdn2-ecros.pl/event/codedive/files/presentations/2017/code%20dive%202017%20-%20Michal%20Dominiak%20-%20Customization%20points%20that%20suck%20less.pdfclass(typeclass) printable {    void print();};struct foo {    void print() { std::cout &lt;&lt; \"foo\"; }};struct bar {    void print() { std::cout &lt;&lt; \"bar\"; }};std::vector&lt;printable&gt; v;v.push_back(foo{});v.push_back(bar{});v[0].print();v[1].print();printable a = foo{};a.print();a = bar{};a.print();You can learn more about typeclasses at  http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p1900r0.html#type-erasureTo quote some lines:      There are no polymorphic types, only a polymorphic use of similar types        By using inheritance to capture polymorphic use, we shift the burden of use to the type implementation, tightly coupling components        Inheritance implies variable size, which implies heap allocation        Heap allocation forces a further burden to manage the object lifetime        Indirection, heap allocation, virtualization impacts performance  Our implementation of typeclasses inspired by https://github.com/seanbaxter/circle/blob/master/erasure/type_erasure.mdUsage notes:  Typeclasses prefer composition over inheritance, so instead of saying a Rectangle is-a Drawable object, you might say it has-a thing which is DrawableSee for details https://github.com/blockspacer/flex_typeclass_pluginSee README file from https://github.com/blockspacer/flex_typeclass_plugin for usage examples.Fast pimpl or type-safe Pimpl implementation without overheadYou can read about Fast pimpl at https://www.cleeus.de/w/blog/2017/03/10/static_pimpl_idiom.html and https://github.com/sqjk/pimpl_ptrClassic pimpl uses heap to store impl (leads to slow construction time) and pointer (leads to slow access time due to cache miss on each function call through pointer to heap).Fast pimpl allows to increase performance in cost of maintainability.// Size and Alignment used by pimpl// must be specified by developer manuallystd::aligned_storage_t&lt;Size, Alignment&gt; storage_;It is possible to minimize maintainability efforts using code generation.We can use clang libtooling to get Size and Alignment automatically based on provided data type.https://github.com/blockspacer/flex_reflect_plugin/ allows to execute libtooling (or any valid C++ code) during compilation step.The basic idea is:  Execute C++ code (before application build step) to store Size and Alignment of some data type.  Store Size and Alignment in some cache (in our case, it is std::map)  Get Size and Alignment from cache and paste them into source code (into std::aligned_storage_t&lt;Size, Alignment&gt; storage_ used by fast pimpl).We will use Fast pimpl implementation via #include &lt;basis/core/pimpl.hpp&gt; from https://github.com/blockspacer/basis/blob/c54ed26250ac3acc0ea5e31cd9424f08204cb450/basis/core/pimpl.hppflex_reflect_plugin allows to execute C++ code at runtime (we need to execute C++ code during compilation step).// exec is similar to executeCodeAndReplace,// but returns empty source code modification#define _executeCode(...) \\  /* generate definition required to use __attribute__ */ \\  __attribute__((annotate( \\        \"{gen};{executeCodeAndReplace};\" \\        #__VA_ARGS__ \\    )))See README from https://github.com/blockspacer/flex_reflect_plugin/ for details.Now we can annotatate any C++ class with _executeCode to extract reflection information from that class (using clang LibTooling).class_executeCode(  []  (    const clang::ast_matchers::MatchFinder::MatchResult&amp; clangMatchResult    , clang::Rewriter&amp; clangRewriter    , const clang::Decl* clangDecl  )  {    clang::SourceManager &amp;SM = clangRewriter.getSourceMgr();    clang::CXXRecordDecl const *record =      clangMatchResult.Nodes        .getNodeAs&lt;clang::CXXRecordDecl&gt;(\"bind_gen\");    if (!record) {      CHECK(false);      return new llvm::Optional&lt;std::string&gt;{};    }    if (!record-&gt;isCompleteDefinition()) {      CHECK(false);      return new llvm::Optional&lt;std::string&gt;{};    }    LOG(INFO)      &lt;&lt; \"record name is \"      &lt;&lt; record-&gt;getNameAsString().c_str();    const clang::ASTRecordLayout&amp; layout      = clangMatchResult.Context-&gt;getASTRecordLayout(record);    uint64_t typeSize =  layout.getSize().getQuantity();    // assume it could be a subclass.    unsigned fieldAlign = layout.getNonVirtualAlignment().getQuantity();    // If the class is final, then we know that the pointer points to an    // object of that type and can use the full alignment.    if (record-&gt;hasAttr&lt;clang::FinalAttr&gt;()) {      fieldAlign = layout.getAlignment().getQuantity();    }    const std::string typeToMapKey      = \"Foo::FooImpl\";    global_storage[\"global_typeSize_for_\" + typeToMapKey]      = typeSize;    global_storage[\"global_fieldAlign_for_\" + typeToMapKey]      = fieldAlign;    LOG(INFO)      &lt;&lt; record-&gt;getNameAsString()      &lt;&lt; \" Size: \" &lt;&lt; typeSize      &lt;&lt; \" Alignment: \" &lt;&lt; fieldAlign &lt;&lt; '\\n';    return new llvm::Optional&lt;std::string&gt;{};  }(clangMatchResult, clangRewriter, clangDecl);)Foo::FooImpl{ public:  FooImpl();  ~FooImpl();  int foo();  std::string baz(); private:  std::string data_{\"somedata\"};};Foo::FooImpl is class that stores implementation (as usual in pimpl pattern). It was annotated by custom annotation attrubute (_executeCode is macro that trasforms provided arguments into string via #__VA_ARGS__ and creates annotation attrubute)global_storage is cache that can store arbitrary data, it is defined in https://github.com/blockspacer/flex_support_headers/blob/ed723f79cf08b14a8ab1e225289a2ad858def154/flex/cling_preloader.inc as below:std::map&lt;    std::string    , std::any  &gt; global_storage;Path to that file (in our case cling_preloader.inc) must be passed to flextool via --cling_scripts= argument (flextool can load arbitrary file with C++ code using Cling interpreter). Note that cling_preloader.inc also included all required C++ header files.We executed C++ code stored in annotation attribute (code was converted into string, see _executeCode above).Executed C++ code used clangMatchResult.Context-&gt;getASTRecordLayout(record); to store Size and Alignment in global_storageNow we must get Size and Alignment from cache and paste them into source code (into std::aligned_storage_t&lt;Size, Alignment&gt; storage_ used by fast pimpl).class Foo {public:  Foo();  ~Foo();  int foo();  std::string baz();private:  class FooImpl;#if !defined(FOO_HPP_NO_CODEGEN)  class  _executeCode(    []    (      const clang::ast_matchers::MatchFinder::MatchResult&amp; clangMatchResult      , clang::Rewriter&amp; clangRewriter      , const clang::Decl* clangDecl    )    {      const std::string typeToMapKey        = \"Foo::FooImpl\";      uint64_t typeSize        = std::any_cast&lt;uint64_t&gt;(            global_storage[\"global_typeSize_for_\" + typeToMapKey]);      unsigned fieldAlign        = std::any_cast&lt;unsigned&gt;(            global_storage[\"global_fieldAlign_for_\" + typeToMapKey]);      std::string fastPimplCode        = \"pimpl::FastPimpl&lt;\";      fastPimplCode += \"FooImpl\";      // sizeof(Foo::FooImpl)      fastPimplCode += \", /*Size*/\";      fastPimplCode += std::to_string(typeSize);      // alignof(Foo::FooImpl)      fastPimplCode += \", /*Alignment*/\";      fastPimplCode += std::to_string(fieldAlign);      fastPimplCode += \"&gt; impl_;\";      /**       * generates code similar to:       *  pimpl::FastPimpl&lt;FooImpl, Size, Alignment&gt; impl_;       **/      return new llvm::Optional&lt;std::string&gt;{std::move(fastPimplCode)};    }(clangMatchResult, clangRewriter, clangDecl);  ) {}#endif // !defined(FOO_HPP_NO_CODEGEN)};We used _executeCode again and returned llvm::Optional&lt;std::string&gt;, that string will store generated code similar to pimpl::FastPimpl&lt;FooImpl, /*Size*/ 64, /*Alignment*/ 12&gt; impl_;Remaining problems:Problem 1: We used Cling C++ interpreter. Resulting code is ugly and (maybe) not fast.Solution: We can create plugin for flextool (plugin is shared library). Comparing to approach that uses Cling C++ interpreter - plugin must be fast and allows to create custom C++ annotations (custom and beautiful C++ annotations).Problem 2: Size differs from compiler to compiler (and even used std version affects Size)Solution: add to retrieved Size approximately 8 bytes (minimal overhead, depends on use-case) and test that code compiles on all desired compilers. Note that if Size is invalid - code will not compile, so it is safe to use Fast Pimpl in production. Make sure that you use SizePolicy::AtLeast, see #include &lt;basis/core/pimpl.hpp&gt; for details.Problem 3: We must parse impl before generation of pimpl::FastPimpl&lt;FooImpl, /*Size*/ 64, /*Alignment*/ 12&gt; impl_; cause it requires Size and Alignment (file order matters).Solution: Make sure that you store impl in separate file from pimpl::FastPimpl and their code generation do not affect each other.We passed FooImpl.hpp to flextool before Foo.cc because Foo.cc requires Size and Alignment from FooImpl.hpp.We do not want to run gode generation based on included header Foo.hpp while parsing FooImpl.hpp (FooImpl.hpp includes Foo.hpp), thats why we used #if !defined(FOO_HPP_NO_CODEGEN) and included Foo.hpp from FooImpl.hpp like so:#if defined(CODEGEN_RUNNING)#define FOO_HPP_NO_CODEGEN 1#include \"Foo.hpp\"#else#include \"Foo.hpp.generated.hpp\"#endifAlso we passed extra-args=-DCODEGEN_RUNNING=1 as argument to flextool.Switching from approach that uses Cling C++ interpreter to flextool plugin (plugin is shared library) can solve a lot of problems listed above. For example, we can inject Foo::Impl code into Foo based on arbitrary data type (to avoid FOO_HPP_NO_CODEGEN and CODEGEN_RUNNING). We can also create custom data structure to cache reflected data in plugin, to avoid global_storage.Problem 4: Source file with public class implementation contains a lot of boilerplate code.Solution: We can generate C++ code that calls the corresponding method of the ‘private’ class and passes arguments to it (proxy method calls to implementation).Prefer not to create you own solution but use existing one:You can use https://github.com/blockspacer/flex_pimpl_pluginSee README file for usage examples: https://github.com/blockspacer/flex_pimpl_pluginUsing existing plugin to add custom C++ metaclassesthat page in developmentYou can learn more about metaclasses at  https://youtu.be/80BZxujhY38Integration with template enginesYou can use https://github.com/blockspacer/flex_squarets_pluginFor example, flex_squarets_plugin allows to use syntax similar javascript template literals in C++:// javascript template literalsconst myVariable = 'test'const mystring = `something ${myVariable}` //something testDefault template engine syntax (CXTPL) allows to rewrite code above as:// custom C++ template syntax using flex_squarets_plugin// After code generation `mystring` will store text `something test`.const std::string myVariable = \"test\";_squaretsString(  R\"raw(    something [[+ myVariable +]]  )raw\")std::string mystring;Writing custom plugin to generate C++ filesthat page in developmentUse case: enum to string and string to enumconst char* SomeEnumToString(SomeEnum e){   switch (e)   {   case Item1:       return \"Item1\";   case Item2:       return \"Item2\";   case Item3:       return \"Item3\";   }   return \"Unknown Item\";}SomeEnum StringToSomeEnum(const char* itemName){   static std::pair&lt;const char*, SomeEnum&gt; items[] = {       {\"Item1\", Item1},       {\"Item2\", Item2},       {\"Item3\", Item3},   };   auto p = std::lower_bound(begin(items), end(items), itemName,                             [](auto&amp;&amp; i, auto&amp;&amp; v) {return strcmp(i.first, v) &lt; 0;});   if (p == end(items) || strcmp(p-&gt;first, itemName) != 0)       throw std::bad_cast();   return p-&gt;second;}Code generator should do:  Find all enum declarations in the input file  Extract items from the particular enum declaration and convert them to the string form  Generate ‘enum to string’ conversion function with the ‘switch’ statement (be careful with scoped enums!)  Sort enum items (in string representation)  Generate ‘string to enum’ conversion function with array and std::lower_boundMatchFinder allows to find enum declaration (clang::EnumDecl):class EnumHandler : public MatchFinder::MatchCallback{public:   void run(const MatchFinder::MatchResult&amp; result) override   {       // Access to the named matching results       if (const clang::EnumDecl* decl = result.Nodes.getNodeAs&lt;clang::EnumDecl&gt;(\"enum\"))       {           // do something useful with the found enum declaration       }   }};Code generation:// generates C++ code for enum to string conversionvoid WriteEnumToStringConversion(std::ostream&amp; os, const EnumDescriptor&amp; enumDescr){   auto&amp; enumName = enumDescr.enumName;   os &lt;&lt; \"inline const char* \" &lt;&lt; enumName &lt;&lt; \"ToString(\" &lt;&lt; enumName &lt;&lt; \" e)\\n{\\n\";   os &lt;&lt; \"    switch (e)\\n\";   os &lt;&lt; \"    {\\n\";   auto scopePrefix = enumDescr.isScoped ? enumName + \"::\" : std::string();   for (auto&amp; i : enumDescr.enumItems)   {       os &lt;&lt; \"    case \" &lt;&lt; scopePrefix &lt;&lt; i &lt;&lt; \":\\n\";       os &lt;&lt; \"        return \\\"\" &lt;&lt; i &lt;&lt; \"\\\";\\n\";   }   os &lt;&lt; \"    }\\n\";   os &lt;&lt; \"    return \\\"Unknown Item\\\";\\n\";   os &lt;&lt; \"}\\n\\n\";}// generates C++ code for string to enum conversionvoid WriteEnumFromStringConversion(std::ostream&amp; os, const EnumDescriptor&amp; enumDescr){   auto&amp; enumName = enumDescr.enumName;   auto scopePrefix = enumDescr.isScoped ? enumName + \"::\" : std::string();   os &lt;&lt; \"inline \" &lt;&lt; enumName &lt;&lt; \" StringTo\" &lt;&lt; enumName &lt;&lt; \"(const char* itemName)\\n{\\n\";   os &lt;&lt; \"    static std::pair&lt;const char*, \" &lt;&lt; enumName &lt;&lt; \"&gt; items[] = {\\n\";   for (auto&amp; i : enumDescr.enumItems)       os &lt;&lt; \"        {\\\"\" &lt;&lt; i &lt;&lt; \"\\\", \" &lt;&lt; scopePrefix &lt;&lt; i &lt;&lt; \"},\\n\";   os &lt;&lt;R\"(    };   auto p = std::lower_bound(begin(items), end(items), itemName,                     [](auto&amp;&amp; i, auto&amp;&amp; v) {return strcmp(i.first, v) &lt; 0;});   if (p == end(items) || strcmp(p-&gt;first, itemName) != 0)       throw std::bad_cast();   return p-&gt;second;})\";}Generating not-C++ filesthat page in developmentOptimizing speedthat page in developmentOptimizing memorythat page in developmentUsing threadsthat page in developmentUsing cling interpreterhttps://github.com/blockspacer/flex_reflect_plugin allows to execute arbitrary C++ code stored in annotation attributes.Integrating with more build systemsthat page in developmentDetecting flextool in Preprocessorflextool defines for clang:-DCLANG_ENABLED=1-DCLANG_IS_ON=1flextool defines for cling:-DCLING_ENABLED=1-DCLING_IS_ON=1You can pass extra-args=-DCODEGEN_RUNNING=1 as argument to flextool and use it as usual C++ define:#if defined(CODEGEN_RUNNING)// ... code here ...#endifExample: Avoid Repetitive Codethat page in developmentC++ is a great language but it sometimes gets too verbose for things you have to do in your code for common tasks. These do very often bring no real value to the business side of your programs – and this is where flextool is here to make your life happier and yourself more productive.The way it works is by plugging into your build process and autogenerating C++ as per a number of project annotations you introduce in your code.Including plugin in your builds is very straight forward. Add plugin into conanfile.py and run conan install. Then tell flextool about files or projects that it must process.Encapsulating object properties via public getter and setter methods is such a common practice in the C++ world: a class with get/set methods for “properties”.This is so common that most IDE’s support autogenerating code for these patterns (and more). This code however needs to live in your sources and also be maintained when, say, a new property is added or a field renamed.Let’s consider this class as an example:class User {    private:        int id;        std::string firstName;        std::string lastName;        int age;    public:        User() {        }        User(const std::string&amp; firstName, const std::string&amp; lastName, int age) {            this.firstName = firstName;            this.lastName = lastName;            this.age = age;        }    // getters and setters: ~30 extra lines of code}This is a rather simple class, but still consider if we added the extra code for getters and setters we’d end up with a definition where we would have more boilerplate zero-value code than the relevant business information: “a User has first and last names, and age.”Let us now flextool-ize this class:class User {    private:        $apply(getter;setter)        int id;        $apply(getter)        std::string firstName;        $apply(            setter        )        std::string lastName;        $apply(            getter;            setter        )        int age;    public:        User() {        }        User(const std::string&amp; firstName, const std::string&amp; lastName, int age) {            this.firstName = firstName;            this.lastName = lastName;            this.age = age;        }}By adding the $apply(getter;setter) annotations we told flextool to, well, generate these for all the fields of the class.Note this is the whole class code, I am not omitting anything as opposed to the version above with the // getters and setters comment. This is a significant saving in code!What if you wanted to refine the visibility of some properties? For example, I like to keep my entities’ id field modifiers package or protected visible. Just use a finer grained setter for this particular field:        $apply(getter;setter(PROTECTED))        int id;You can find complete code of that example on Github.Example: codestyle validation of interfaceInterface must have only pure virtual methods, and a virtual destructor, and no data, and no private members, this pattern duplicated over and over in your code every time you create an interface.This leads to the risks of code duplication, for example forgetting the virtual destructor once in a while for example.Reflection allows to access some data about the class, such as: are all the methods public?And compile time programming makes checks at compile time, like: is there any private member, or is there any data member, which is not supposed to be the case in an interface. And after performing those compile time checks, compile time programming allows to emit custom compile errors messages such as “an interface cannot have private data”.TODO: example:writing prototype with the help of cling interpreterTODO: example: translating code that uses cling interpreter to plugin (shared library) for better performanceYou can find complete code of that example on Github.Example: codestyle validation of private class membersQuote from Google C++ Style Guide, section Class Data Members https://google.github.io/styleguide/cppguide.htmlData members of classes, both static and non-static, are named like ordinary nonmember variables, but with a trailing underscore.class TableInfo {  ... private:  std::string table_name_;  // OK - underscore at end.  static Pool&lt;TableInfo&gt;* pool_;  // OK.};We can add custom annotation near class declaration to validate that within that class all data members are named with a trailing underscore.class$apply(  styleguide(data_members = googleStyleGuide))TableInfo {  ... private:  std::string table_name_;  // OK - underscore at end.  static Pool&lt;TableInfo&gt;* pool_;  // OK.};You can find complete code of that example on Github.Example: serialization (networking) and deserializationTODOExample: using as REST API router (networking)TODOExample: Pattern-matching expressionsTODOExample: Spaceship operatorTODOExample: format libraryEmbeds the arguments themselves into the format specifier string. It’s like Python f-strings, but for C++.TODOExample: using as user input validator (networking)TODOExample: editor integrationTODOExample: serialization (to file) and deserializationTODOExample: include copyright and license information from LICENSE file and copyright template (date may change)TODOCode of unit teststhat page in developmentTroubleshootingthat page in developmentAbout SourceTransformCallbackFunction signature for code transformation must be compatible with SourceTransformCallback:struct SourceTransformResult {  ///\\brief may be used to replace orginal code.  /// To keep orginal code set it as nullptr.  const char* replacer = nullptr;};/**  * \\brief callback that will be called then parser  *        found custom attribute.**/struct SourceTransformOptions {  /**    * currently executed function    * (function name parsed from annotation)  **/  const flexlib::parsed_func&amp; func_with_args;  /**    * see https://xinhuang.github.io/posts/2015-02-08-clang-tutorial-the-ast-matcher.html  **/  const clang::ast_matchers::MatchFinder::MatchResult&amp; matchResult;  /**    * see https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-3-rewriting-code-with-clang-tidy/  **/  clang::Rewriter&amp; rewriter;  /**    * found by MatchFinder    * see https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-2-examining-the-clang-ast-with-clang-query/  **/  const clang::Decl* decl = nullptr;  /**    * All arguments extracted from attribute.    * Example:    * $apply(interface, foo_with_args(1, \"2\"))    * becomes two `parsed_func` - `interface` and `foo_with_args`.  **/  const std::vector&lt;flexlib::parsed_func&gt;&amp; all_func_with_args;};typedef  base::RepeatingCallback&lt;    SourceTransformResult(const SourceTransformOptions&amp; callback_args)  &gt;  SourceTransformCallback;Think about function name as one of __VA_ARGS__ from#define $apply(...) \\  __attribute__((annotate(\"{gen};{funccall};\" #__VA_ARGS__)))Example where make_interface and make_removefuncbody - two function names:$apply(make_interface;  make_removefuncbody)For contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/tutorial/"
      }
      ,
    
      "talks": {
        "title": "talks",
        "author": "",
        "category": "",
        "content": "TODOthat page in developmentFor contibutorsFell free to open GitHub Issue if you know how to improve that page",
        "url": "/flex_docs/talks/"
      }
      
    
  };
</script>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jekyll">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jekyll</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">© 2019</p>
        <p class="text">Last update: 05.06.2020 09:23:50</p>

        <p class="text"><a href="/flex_docs/jekyll_how_to/">About this site</a></p>
      </div>
    </div>

  </div>

</footer>


    <script async src="/flex_docs/scripts/main.min.js"></script>

  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register("/flex_docs/sw.js").then(function() {
      console.log("Service Worker Registered");
    });
  }
  </script>
  </body>

</html>
